(()=>{"use strict";const t=function(t,e,o,s,n,i,r,c,a){function h(c,a,h){var u=this;this.contentId=a,this.contentData=h,this.userResponses=[],o.call(this,"single-choice-set"),this.options=t.extend(!0,{},{choices:[],overallFeedback:[],behaviour:{autoContinue:!0,timeoutCorrect:2e3,timeoutWrong:3e3,soundEffectsEnabled:!0,enableRetry:!0,enableSolutionsButton:!0,passPercentage:100}},c),h&&void 0!==h.previousState&&(this.currentIndex=h.previousState.progress,this.results=h.previousState.answers,this.userResponses=void 0!==h.previousState.userResponses?h.previousState.userResponses:[]),this.currentIndex=this.currentIndex||0,this.results=this.results||{corrects:0,wrongs:0},this.options.behaviour.autoContinue||(this.options.behaviour.timeoutCorrect=0,this.options.behaviour.timeoutWrong=0),this.stopWatches=[],this.startStopWatch(this.currentIndex),this.muted=!1===this.options.behaviour.soundEffectsEnabled,this.l10n=H5P.jQuery.extend({correctText:"Correct!",incorrectText:"Incorrect!",shouldSelect:"Should have been selected",shouldNotSelect:"Should not have been selected",nextButtonLabel:"Next question",showSolutionButtonLabel:"Show solution",retryButtonLabel:"Retry",closeButtonLabel:"Close",solutionViewTitle:"Solution",slideOfTotal:"Slide :num of :total",muteButtonLabel:"Mute feedback sound",scoreBarLabel:"You got :num out of :total points",solutionListQuestionNumber:"Question :num",a11yShowSolution:"Show the solution. The task will be marked with its correct solution.",a11yRetry:"Retry the task. Reset all responses and start the task over again."},void 0!==c.l10n?c.l10n:{}),this.$container=t("<div>",{class:"h5p-sc-set-wrapper navigatable"+(this.options.behaviour.autoContinue?"":" next-button-mode")}),this.$slides=[],this.choices=[],u.buttonsToBeHidden=[],this.solutionView=new n(a,this.options.choices,this.l10n),this.$choices=t("<div>",{class:"h5p-sc-set h5p-sc-animate"}),this.options.choices=this.options.choices.filter((function(t){return void 0!==t&&!!t.answers}));var l=this.options.choices.length;u.progressbar=e.createProgressbar(l+1,{progressText:this.l10n.slideOfTotal}),u.progressbar.setProgress(this.currentIndex);for(var p=0;p<this.options.choices.length;p++){var d=new s(this.options.choices[p],p,this.contentId,this.options.behaviour.autoContinue);d.on("finished",this.handleQuestionFinished,this),d.on("alternative-selected",this.handleAlternativeSelected,this),d.appendTo(this.$choices,p===this.currentIndex),this.choices.push(d),this.$slides.push(d.$choice)}this.resultSlide=new i(this.options.choices.length),this.resultSlide.appendTo(this.$choices),this.resultSlide.on("retry",this.resetTask,this),this.resultSlide.on("view-solution",this.handleViewSolution,this),this.$slides.push(this.resultSlide.$resultSlide),this.on("resize",this.resize,this),this.recklessJump(this.currentIndex),this.options.choices.length===this.currentIndex&&(this.resultSlide.$resultSlide.addClass("h5p-sc-current-slide"),this.setScore(this.results.corrects,!0)),this.muted||setTimeout((function(){r.setup(u.getLibraryFilePath(""))}),1),this.superHideButton=u.hideButton,this.hideButton=function(t){return u.scoreTimeout?(u.buttonsToBeHidden.push(t),this):u.superHideButton(t)}}h.prototype=Object.create(o.prototype),h.prototype.constructor=h,h.prototype.setTabbable=function(t,e){t&&t.attr("tabindex",e?0:-1)},h.prototype.handleAlternativeSelected=function(t){var e=this;this.lastAnswerIsCorrect=t.data.correct,e.toggleNextButton(!0),this.results[this.lastAnswerIsCorrect?"corrects":"wrongs"]++,e.triggerXAPI("interacted"),e.readA11yFriendlyText(t.data.index,t.data.currentIndex),this.muted||r.play(this.lastAnswerIsCorrect?"positive-short":"negative-short",700)},h.prototype.handleQuestionFinished=function(t){var e=this,o=t.data.index,s=e.userResponses[o]=t.data.answerIndex,n=this.stopStopWatch(o),i=e.createXApiAnsweredEvent(e.options.choices[o],s,n);e.trigger(i),e.continue(o)},h.prototype.continue=function(t){var e=this;if(e.choices[t].setA11yTextReadable(),e.options.behaviour.autoContinue){var o,s=function(){e.$container.off("click.impatient keydown.impatient"),clearTimeout(o),e.next()};o=setTimeout((function(){s()}),e.lastAnswerIsCorrect?e.options.behaviour.timeoutCorrect:e.options.behaviour.timeoutWrong),e.onImpatientUser(s)}else e.$nextButton.focus()},h.prototype.onImpatientUser=function(t){this.$container.off("click.impatient keydown.impatient"),this.$container.one("click.impatient",t),this.$container.one("keydown.impatient",(function(e){[13,32,39].indexOf(e.which)&&t()}))},h.prototype.next=function(){this.move(this.currentIndex+1)},h.prototype.createXApiAnsweredEvent=function(t,e,o){var s=this,n=c.interactionTypes,i=c.createDefinition().interactionType(n.CHOICE).description(t.question).correctResponsesPattern(s.getXApiCorrectResponsePattern()).optional(s.getXApiChoices(t.answers)).build(),r=c.createResult().response(e.toString()).duration(o).score(0===e?1:0,1).completion(!0).success(0===e).build();return c.create().verb(c.verbs.ANSWERED).objectDefinition(i).context(s.contentId,s.subContentId).contentId(s.contentId,t.subContentId).result(r).build()},h.prototype.getXApiCorrectResponsePattern=function(){return[c.createCorrectResponsePattern([(0).toString()])]},h.prototype.getXApiChoices=function(t){return{choices:t.map((function(t,e){return c.createChoice(e.toString(),t)}))}},h.prototype.handleQueuedButtonChanges=function(){var t=this;t.buttonsToBeHidden.length&&t.buttonsToBeHidden.forEach((function(e){t.superHideButton(e)})),t.buttonsToBeHidden=[]},h.prototype.setScore=function(t,e){var o=this;if(o.choices.length){var s=u(o.options.overallFeedback,t/o.options.choices.length).replace(":numcorrect",t).replace(":maxscore",o.options.choices.length.toString());o.setFeedback(s,t,o.options.choices.length,o.l10n.scoreBarLabel),t===o.options.choices.length?(o.hideButton("try-again"),o.hideButton("show-solution")):(o.showButton("try-again"),o.showButton("show-solution")),o.handleQueuedButtonChanges(),o.scoreTimeout=void 0,e||o.triggerXAPIScored(t,o.options.choices.length,"completed",!0,100*t/o.options.choices.length>=o.options.behaviour.passPercentage),o.trigger("resize")}},h.prototype.handleViewSolution=function(){var e=this,o=t(".h5p-question-try-again",e.$container),s=t(".h5p-question-show-solution",e.$container),n=[e.$muteButton,o,s];n.forEach((function(t){e.setTabbable(t,!1)})),e.solutionView.on("hide",(function(){n.forEach((function(t){e.setTabbable(t,!0)})),e.toggleAriaVisibility(!0),e.focusButton()})),e.solutionView.show(),e.toggleAriaVisibility(!1)},h.prototype.toggleAriaVisibility=function(t){var e=this,o=t?"":"true";e.$muteButton&&e.$muteButton.attr("aria-hidden",o),e.progressbar.$progressbar.attr("aria-hidden",o),e.$choices.attr("aria-hidden",o)},h.prototype.registerDomElements=function(){this.setContent(this.createQuestion()),this.addButtons(),this.insertSectionAtElement("feedback",this.resultSlide.$feedbackContainer),this.insertSectionAtElement("scorebar",this.resultSlide.$feedbackContainer),this.insertSectionAtElement("buttons",this.resultSlide.$buttonContainer),this.options.choices.length===this.currentIndex&&this.trigger("question-finished"),this.trigger("resize")},h.prototype.addButtons=function(){var t=this;this.options.behaviour.enableRetry&&this.addButton("try-again",this.l10n.retryButtonLabel,(function(){t.resetTask()}),t.results.corrects!==t.options.choices.length,{"aria-label":this.l10n.a11yRetry}),this.options.behaviour.enableSolutionsButton&&this.addButton("show-solution",this.l10n.showSolutionButtonLabel,(function(){t.showSolutions()}),t.results.corrects!==t.options.choices.length,{"aria-label":this.l10n.a11yShowSolution})},h.prototype.createQuestion=function(){var o=this;function s(e){var s=t(e.target);e.preventDefault(),o.muted=!o.muted,s.attr("aria-pressed",o.muted)}if(o.progressbar.appendTo(o.$container),o.$container.append(o.$choices),!this.options.behaviour.autoContinue){var n=function(){"true"!==o.$nextButton.attr("aria-disabled")&&o.next()};o.$nextButton=e.createButton({class:"h5p-ssc-next-button","aria-label":o.l10n.nextButtonLabel,click:n,keydown:function(t){switch(t.which){case 13:case 32:n(),t.preventDefault()}},appendTo:o.$container}),o.toggleNextButton(!1)}return o.options.behaviour.soundEffectsEnabled&&(o.$muteButton=t("<div>",{class:"h5p-sc-sound-control",tabindex:0,role:"button","aria-label":o.l10n.muteButtonLabel,"aria-pressed":!1,on:{keydown:function(t){switch(t.which){case 13:case 32:s(t)}}},click:s,prependTo:o.$container})),o.solutionView.appendTo(o.$container),o.resize(),o.$container.addClass("initialized"),o.$container},h.prototype.resize=function(){var t=0;this.choices.forEach((function(e){var o=e.$choice.outerHeight();t=o>t?o:t})),this.$choices.css({minHeight:t+"px"})},h.prototype.toggleNextButton=function(t){this.$nextButton&&this.$nextButton.attr("aria-disabled",!t)},h.prototype.recklessJump=function(t){var e="translateX("+100*-t+"%)";this.$choices.css({"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e,transform:e}),this.progressbar.setProgress(t+1)},h.prototype.move=function(t){var e=this;if(!(t===this.currentIndex||t>e.$slides.length-1)){var o=e.$slides[e.currentIndex],s=e.choices[t],n=e.$slides[t],i=t>=e.choices.length;e.toggleNextButton(!1),H5P.Transition.onTransitionEnd(e.$choices,(function(){o.removeClass("h5p-sc-current-slide"),i?e.resultSlide.focusScore():s.focusOnAlternative(0)}),600),i&&e.setScore(e.results.corrects),e.$container.toggleClass("navigatable",!i),this.startStopWatch(t),n.addClass("h5p-sc-current-slide"),e.recklessJump(t),e.currentIndex=t}},h.prototype.startStopWatch=function(t){this.stopWatches[t]=this.stopWatches[t]||new a,this.stopWatches[t].start()},h.prototype.stopStopWatch=function(t){this.stopWatches[t]&&this.stopWatches[t].stop()},h.prototype.timePassedInStopWatch=function(t){return void 0!==this.stopWatches[t]?this.stopWatches[t].passedTime():0},h.prototype.getTotalPassedTime=function(){return this.stopWatches.filter((function(t){return null!=t})).reduce((function(t,e){return t+e.passedTime()}),0)},h.prototype.getScore=function(){return this.results.corrects},h.prototype.getMaxScore=function(){return this.options.choices.length},h.prototype.getAnswerGiven=function(){return this.results.corrects+this.results.wrongs>0},h.prototype.getTitle=function(){return H5P.createTitle(this.contentData&&this.contentData.metadata&&this.contentData.metadata.title?this.contentData.metadata.title:"Single Choice Set")},h.prototype.getXAPIData=function(){var t=this,e=t.options.choices.map((function(e,o){var s=t.userResponses[o]>=0?t.userResponses[o]:"",n=t.timePassedInStopWatch(o);return{statement:t.createXApiAnsweredEvent(e,s,n).data.statement}})),o=c.createResult().score(t.getScore(),t.getMaxScore()).duration(t.getTotalPassedTime()).build(),s=c.createDefinition().interactionType(c.interactionTypes.COMPOUND).build();return{statement:c.create().verb(c.verbs.ANSWERED).contentId(t.contentId,t.subContentId).context(t.getParentAttribute("contentId"),t.getParentAttribute("subContentId")).objectDefinition(s).result(o).build().data.statement,children:e}},h.prototype.getParentAttribute=function(t){if(void 0!==this.parent)return this.parent[t]},h.prototype.showSolutions=function(){this.handleViewSolution()},h.prototype.resetTask=function(){var t=this;this.solutionView.hide();for(var e=["h5p-sc-reveal-wrong","h5p-sc-reveal-correct","h5p-sc-selected","h5p-sc-drummed","h5p-sc-correct-answer"],o=0;o<e.length;o++)this.$choices.find("."+e[o]).removeClass(e[o]);this.results={corrects:0,wrongs:0},this.choices.forEach((function(t){t.setAnswered(!1),t.resetA11yText(),t.resetAriaAttributes()})),this.stopWatches.forEach((function(t){t&&t.reset()})),this.move(0),H5P.Transition.onTransitionEnd(this.$choices,(function(){t.removeFeedback()}),600)},h.prototype.getCurrentState=function(){return{progress:this.currentIndex,answers:this.results,userResponses:this.userResponses}},h.prototype.readA11yFriendlyText=function(t,e){var o=this,s=o.$choices.find(".h5p-sc-is-correct")[t].textContent.replace(/[\n\r]+|[\s]{2,}/g," ").trim();let n=this.lastAnswerIsCorrect?o.l10n.correctText:o.l10n.incorrectText;o.options.behaviour.autoContinue||(n=this.lastAnswerIsCorrect?o.l10n.correctText+o.l10n.shouldSelect:o.l10n.incorrectText+o.l10n.shouldNotSelect,o.$choices.find(".h5p-sc-current-slide .h5p-sc-is-correct .h5p-sc-a11y").text(o.l10n.shouldSelect),o.$choices.find(".h5p-sc-current-slide .h5p-sc-is-wrong .h5p-sc-a11y").text(o.l10n.shouldNotSelect),o.$choices.find(".h5p-sc-current-slide .h5p-sc-alternative").eq(e).find(".h5p-sc-a11y").text(n),n=this.lastAnswerIsCorrect?o.l10n.correctText:o.l10n.incorrectText+s+o.l10n.shouldSelect),o.read(n)};var u=function(t,e){e=Math.floor(100*e);for(var o=0;o<t.length;o++){var s=t[o],n=void 0!==s.feedback&&0!==s.feedback.trim().length;if(s.from<=e&&s.to>=e&&n)return s.feedback}return""};return h}(H5P.jQuery,H5P.JoubelUI,H5P.Question,H5P.SingleChoiceSet.SingleChoice,H5P.SingleChoiceSet.SolutionView,H5P.SingleChoiceSet.ResultSlide,H5P.SingleChoiceSet.SoundEffects,H5P.SingleChoiceSet.XApiEventBuilder,H5P.SingleChoiceSet.StopWatch);H5P=H5P||{},H5P.Tooltip=H5P.Tooltip||function(){},H5P.SingleChoiceSet=t})();