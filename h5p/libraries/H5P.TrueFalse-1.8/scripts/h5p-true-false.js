(()=>{"use strict";var t={d:(e,n)=>{for(var s in n)t.o(n,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:n[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Decoder:()=>si,Encoder:()=>ei,PacketType:()=>ti,protocol:()=>Zr});const n=()=>new Map,s=t=>{const e=n();return t.forEach(((t,n)=>{e.set(n,t)})),e},r=(t,e,n)=>{let s=t.get(e);return void 0===s&&t.set(e,s=n()),s},i=()=>new Set,o=t=>t[t.length-1],c=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},h=Array.from,a=Array.isArray;class l{constructor(){this._observers=n()}on(t,e){r(this._observers,t,i).add(e)}once(t,e){const n=(...s)=>{this.off(t,n),e(...s)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return h((this._observers.get(t)||n()).values()).forEach((t=>t(...e)))}destroy(){this._observers=n()}}const u=Math.floor,d=(Math.ceil,Math.abs),p=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),f=(t,e)=>t>e?t:e,g=(Number.isNaN,Math.pow,Math.sign,t=>0!==t?t<0:1/t<0),y=String.fromCharCode,w=(String.fromCodePoint,y(65535),/^\s*/g),m=/([A-Z])/g,b=(t,e)=>(t=>t.replace(w,""))(t.replace(m,(t=>`${e}${(t=>t.toLowerCase())(t)}`))),k="undefined"!=typeof TextEncoder?new TextEncoder:null,_=k?t=>k.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,s=new Uint8Array(n);for(let t=0;t<n;t++)s[t]=e.codePointAt(t);return s};let v="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});v&&1===v.decode(new Uint8Array).length&&(v=null);let S=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},C=!0;try{"undefined"!=typeof localStorage&&(S=localStorage,C=!1)}catch(t){}const E=S,A=Object.assign,D=Object.keys,O=t=>D(t).length,N=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),T=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&T(t,e,n+1)}},I=t=>t,L=(t,e)=>{if(null==t||null==e)return((t,e)=>t===e)(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!L(t.get(n),e.get(n)))return!1;break;case Object:if(O(t)!==O(e))return!1;for(const n in t)if(!N(t,n)||!L(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!L(t[n],e[n]))return!1;break;default:return!1}return!0},R="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name),x="undefined"!=typeof window&&"undefined"!=typeof document&&!R;let M;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const B=[],U=t=>(()=>{if(void 0===M)if(R){M=n();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const s=t[n];"-"===s[0]?(null!==e&&M.set(e,""),e=s):null!==e?(M.set(e,s),e=null):B.push(s)}null!==e&&M.set(e,"")}else"object"==typeof location?(M=n(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");M.set(`--${b(e,"-")}`,n),M.set(`-${b(e,"-")}`,n)}}))):M=n();return M})().has(t),P=t=>{return void 0===(e=R?process.env[t.toUpperCase()]:E.getItem(t))?null:e;var e};U("--"+"production")||P("production");const j=R&&((t,e)=>["true","1","2"].includes(t))(process.env.FORCE_COLOR),q=!U("no-colors")&&(!R||process.stdout.isTTY||j)&&(!R||U("color")||j||null!==P("COLORTERM")||(P("TERM")||"").includes("color")),F=t=>new Uint8Array(t),H=(t,e,n)=>new Uint8Array(t,e,n),V=x?t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=y(t[n]);return btoa(e)}:t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),W=x?t=>{const e=atob(t),n=F(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}:t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},z=64,J=128,$=127,K=Number.MAX_SAFE_INTEGER,Y=(Number.MIN_SAFE_INTEGER,Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&u(t)===t));Number.isNaN,Number.parseInt;class G{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const X=()=>new G,Q=t=>{const e=new Uint8Array((t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e})(t));let n=0;for(let s=0;s<t.bufs.length;s++){const r=t.bufs[s];e.set(r,n),n+=r.length}return e.set(H(t.cbuf.buffer,0,t.cpos),n),e},Z=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},tt=Z,et=(t,e)=>{for(;e>$;)Z(t,J|$&e),e=u(e/128);Z(t,$&e)},nt=(t,e)=>{const n=g(e);for(n&&(e=-e),Z(t,(e>63?J:0)|(n?z:0)|63&e),e=u(e/64);e>0;)Z(t,(e>$?J:0)|$&e),e=u(e/128)},st=new Uint8Array(3e4),rt=st.length/3,it=k&&k.encodeInto?(t,e)=>{if(e.length<rt){const n=k.encodeInto(e,st).written||0;et(t,n);for(let e=0;e<n;e++)Z(t,st[e])}else ct(t,_(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),s=n.length;et(t,s);for(let e=0;e<s;e++)Z(t,n.codePointAt(e))},ot=(t,e)=>{const n=t.cbuf.length,s=t.cpos,r=p(n-s,e.length),i=e.length-r;t.cbuf.set(e.subarray(0,r),s),t.cpos+=r,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(f(2*n,i)),t.cbuf.set(e.subarray(r)),t.cpos=i)},ct=(t,e)=>{et(t,e.byteLength),ot(t,e)},ht=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(H(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*f(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},at=new DataView(new ArrayBuffer(4)),lt=(t,e)=>{switch(typeof e){case"string":Z(t,119),it(t,e);break;case"number":Y(e)&&d(e)<=2147483647?(Z(t,125),nt(t,e)):(n=e,at.setFloat32(0,n),at.getFloat32(0)===n?(Z(t,124),((t,e)=>{ht(t,4).setFloat32(0,e,!1)})(t,e)):(Z(t,123),((t,e)=>{ht(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":Z(t,122),((t,e)=>{ht(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)Z(t,126);else if(a(e)){Z(t,117),et(t,e.length);for(let n=0;n<e.length;n++)lt(t,e[n])}else if(e instanceof Uint8Array)Z(t,116),ct(t,e);else{Z(t,118);const n=Object.keys(e);et(t,n.length);for(let s=0;s<n.length;s++){const r=n[s];it(t,r),lt(t,e[r])}}break;case"boolean":Z(t,e?120:121);break;default:Z(t,127)}var n};class ut extends G{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&et(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const dt=t=>{t.count>0&&(nt(t.encoder,1===t.count?t.s:-t.s),t.count>1&&et(t.encoder,t.count-2))};class pt{constructor(){this.encoder=new G,this.s=0,this.count=0}write(t){this.s===t?this.count++:(dt(this),this.count=1,this.s=t)}toUint8Array(){return dt(this),Q(this.encoder)}}const ft=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);nt(t.encoder,e),t.count>1&&et(t.encoder,t.count-2)}};class gt{constructor(){this.encoder=new G,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ft(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ft(this),Q(this.encoder)}}class yt{constructor(){this.sarr=[],this.s="",this.lensE=new pt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new G;return this.sarr.push(this.s),this.s="",it(t,this.sarr.join("")),ot(t,this.lensE.toUint8Array()),Q(t)}}const wt=t=>new Error(t),mt=()=>{throw wt("Method unimplemented")},bt=()=>{throw wt("Unexpected case")},kt=wt("Unexpected end of array"),_t=wt("Integer out of Range");class vt{constructor(t){this.arr=t,this.pos=0}}const St=t=>new vt(t),Ct=t=>((t,e)=>{const n=H(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n})(t,At(t)),Et=t=>t.arr[t.pos++],At=t=>{let e=0,n=1;const s=t.arr.length;for(;t.pos<s;){const s=t.arr[t.pos++];if(e+=(s&$)*n,n*=128,s<J)return e;if(e>K)throw _t}throw kt},Dt=t=>{let e=t.arr[t.pos++],n=63&e,s=64;const r=(e&z)>0?-1:1;if(0==(e&J))return r*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n+=(e&$)*s,s*=128,e<J)return r*n;if(n>K)throw _t}throw kt},Ot=v?t=>v.decode(Ct(t)):t=>{let e=At(t);if(0===e)return"";{let n=String.fromCodePoint(Et(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Et(t));else for(;e>0;){const s=e<1e4?e:1e4,r=t.arr.subarray(t.pos,t.pos+s);t.pos+=s,n+=String.fromCodePoint.apply(null,r),e-=s}return decodeURIComponent(escape(n))}},Nt=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},Tt=[t=>{},t=>null,Dt,t=>Nt(t,4).getFloat32(0,!1),t=>Nt(t,8).getFloat64(0,!1),t=>Nt(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Ot,t=>{const e=At(t),n={};for(let s=0;s<e;s++)n[Ot(t)]=It(t);return n},t=>{const e=At(t),n=[];for(let s=0;s<e;s++)n.push(It(t));return n},Ct],It=t=>Tt[127-Et(t)](t);class Lt extends vt{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),(t=this).pos!==t.arr.length?this.count=At(this)+1:this.count=-1),this.count--,this.s;var t}}class Rt extends vt{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=Dt(this);const t=g(this.s);this.count=1,t&&(this.s=-this.s,this.count=At(this)+2)}return this.count--,this.s}}class xt extends vt{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=Dt(this),e=1&t;this.diff=u(t/2),this.count=1,e&&(this.count=At(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Mt{constructor(t){this.decoder=new Rt(t),this.str=Ot(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}crypto.subtle;const Bt=crypto.getRandomValues.bind(crypto),Ut=(Math.random,()=>Bt(new Uint32Array(1))[0]),Pt=[1e7]+-1e3+-4e3+-8e3+-1e11,jt=()=>Pt.replace(/[018]/g,(t=>(t^Ut()&15>>t/4).toString(16))),qt=t=>new Promise(t);Promise.all.bind(Promise);class Ft{constructor(t,e){this.left=t,this.right=e}}const Ht=(t,e)=>new Ft(t,e),Vt="undefined"!=typeof document?document:{},Wt=("undefined"!=typeof DOMParser&&new DOMParser,Vt.ELEMENT_NODE,Vt.TEXT_NODE,Vt.CDATA_SECTION_NODE,Vt.COMMENT_NODE,Vt.DOCUMENT_NODE,Vt.DOCUMENT_TYPE_NODE,Vt.DOCUMENT_FRAGMENT_NODE,Symbol),zt=Date.now,Jt=Wt(),$t=Wt(),Kt=Wt(),Yt=Wt(),Gt=Wt(),Xt=Wt(),Qt=Wt(),Zt=Wt(),te=Wt();zt();const ee={[Jt]:Ht("font-weight","bold"),[$t]:Ht("font-weight","normal"),[Kt]:Ht("color","blue"),[Gt]:Ht("color","green"),[Yt]:Ht("color","grey"),[Xt]:Ht("color","red"),[Qt]:Ht("color","purple"),[Zt]:Ht("color","orange"),[te]:Ht("color","black")},ne=q?t=>{const e=[],s=[],r=n();let i=[],o=0;for(;o<t.length;o++){const n=t[o],i=ee[n];if(void 0!==i)r.set(i.left,i.right);else{if(n.constructor!==String&&n.constructor!==Number)break;{const t=((t,e)=>{const n=[];for(const[s,r]of t)n.push(e(r,s));return n})(r,((t,e)=>`${e}:${t};`)).join("");o>0||t.length>0?(e.push("%c"+n),s.push(t)):e.push(n)}}}for(o>0&&(i=s,i.unshift(e.join("")));o<t.length;o++){const e=t[o];e instanceof Symbol||i.push(e)}return i}:t=>{const e=[],n=[];let s=0;for(;s<t.length;s++){const r=t[s];r.constructor===String||r.constructor===Number?e.push(r):r.constructor===Object&&n.push(JSON.stringify(r))}return n},se=i(),re=t=>({[Symbol.iterator](){return this},next:t}),ie=(t,e)=>re((()=>{const{done:n,value:s}=t.next();return{done:n,value:n?void 0:e(s)}}));class oe{constructor(t,e){this.clock=t,this.len=e}}class ce{constructor(){this.clients=new Map}}const he=(t,e,n)=>e.clients.forEach(((e,s)=>{const r=t.doc.store.clients.get(s);for(let s=0;s<e.length;s++){const i=e[s];nn(t,r,i.clock,i.len,n)}})),ae=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,s=t.length-1;for(;n<=s;){const r=u((n+s)/2),i=t[r],o=i.clock;if(o<=e){if(e<o+i.len)return r;n=r+1}else s=r-1}return null})(n,e.clock)},le=t=>{t.clients.forEach((t=>{let e,n;for(t.sort(((t,e)=>t.clock-e.clock)),e=1,n=1;e<t.length;e++){const s=t[n-1],r=t[e];s.clock+s.len>=r.clock?s.len=f(s.len,r.clock+r.len-s.clock):(n<e&&(t[n]=r),n++)}t.length=n}))},ue=(t,e,n,s)=>{r(t.clients,e,(()=>[])).push(new oe(n,s))},de=()=>new ce,pe=(t,e)=>{et(t.restEncoder,e.clients.size),h(e.clients.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{t.resetDsCurVal(),et(t.restEncoder,e);const s=n.length;et(t.restEncoder,s);for(let e=0;e<s;e++){const s=n[e];t.writeDsClock(s.clock),t.writeDsLen(s.len)}}))},fe=t=>{const e=new ce,n=At(t.restDecoder);for(let s=0;s<n;s++){t.resetDsCurVal();const n=At(t.restDecoder),s=At(t.restDecoder);if(s>0){const i=r(e.clients,n,(()=>[]));for(let e=0;e<s;e++)i.push(new oe(t.readDsClock(),t.readDsLen()))}}return e},ge=(t,e,n)=>{const s=new ce,r=At(t.restDecoder);for(let i=0;i<r;i++){t.resetDsCurVal();const r=At(t.restDecoder),i=At(t.restDecoder),o=n.clients.get(r)||[],c=Ye(n,r);for(let n=0;n<i;n++){const n=t.readDsClock(),i=n+t.readDsLen();if(n<c){c<i&&ue(s,r,c,i-c);let t=Xe(o,n),h=o[t];for(!h.deleted&&h.id.clock<n&&(o.splice(t+1,0,Ms(e,h,n-h.id.clock)),t++);t<o.length&&(h=o[t++],h.id.clock<i);)h.deleted||(i<h.id.clock+h.length&&o.splice(t,0,Ms(e,h,i-h.id.clock)),h.delete(e))}else ue(s,r,n,i-n)}}if(s.clients.size>0){const t=new Ee;return et(t.restEncoder,0),pe(t,s),t.toUint8Array()}return null},ye=Ut;class we extends l{constructor({guid:t=jt(),collectionid:e=null,gc:n=!0,gcFilter:s=(()=>!0),meta:r=null,autoLoad:i=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=s,this.clientID=ye(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new $e,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=i,this.meta=r,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=qt((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const c=()=>qt((t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=c()),this.isSynced=void 0===t||!0===t,this.isLoaded||this.emit("load",[])})),this.whenSynced=c()}load(){const t=this._item;null===t||this.shouldLoad||an(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(h(this.subdocs).map((t=>t.guid)))}transact(t,e=null){return an(this,t,e)}get(t,e=On){const n=r(this.share,t,(()=>{const t=new e;return t._integrate(this,null),t})),s=n.constructor;if(e!==On&&s!==e){if(s===On){const s=new e;s._map=n._map,n._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=s})),s._start=n._start;for(let t=s._start;null!==t;t=t.right)t.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,Jn)}getText(t=""){return this.get(t,hs)}getMap(t=""){return this.get(t,Kn)}getXmlFragment(t=""){return this.get(t,ls)}toJSON(){const t={};return this.share.forEach(((e,n)=>{t[n]=e.toJSON()})),t}destroy(){h(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new we({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,an(t.parent.doc,(n=>{const s=e.doc;t.deleted||n.subdocsAdded.add(s),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class me{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return At(this.restDecoder)}readDsLen(){return At(this.restDecoder)}}class be extends me{readLeftID(){return Fe(At(this.restDecoder),At(this.restDecoder))}readRightID(){return Fe(At(this.restDecoder),At(this.restDecoder))}readClient(){return At(this.restDecoder)}readInfo(){return Et(this.restDecoder)}readString(){return Ot(this.restDecoder)}readParentInfo(){return 1===At(this.restDecoder)}readTypeRef(){return At(this.restDecoder)}readLen(){return At(this.restDecoder)}readAny(){return It(this.restDecoder)}readBuf(){return(t=>{const e=F(t.byteLength);return e.set(t),e})(Ct(this.restDecoder))}readJSON(){return JSON.parse(Ot(this.restDecoder))}readKey(){return Ot(this.restDecoder)}}class ke{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=At(this.restDecoder),this.dsCurrVal}readDsLen(){const t=At(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class _e extends ke{constructor(t){super(t),this.keys=[],At(t),this.keyClockDecoder=new xt(Ct(t)),this.clientDecoder=new Rt(Ct(t)),this.leftClockDecoder=new xt(Ct(t)),this.rightClockDecoder=new xt(Ct(t)),this.infoDecoder=new Lt(Ct(t),Et),this.stringDecoder=new Mt(Ct(t)),this.parentInfoDecoder=new Lt(Ct(t),Et),this.typeRefDecoder=new Rt(Ct(t)),this.lenDecoder=new Rt(Ct(t))}readLeftID(){return new je(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new je(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return It(this.restDecoder)}readBuf(){return Ct(this.restDecoder)}readJSON(){return It(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class ve{constructor(){this.restEncoder=X()}toUint8Array(){return Q(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){et(this.restEncoder,t)}writeDsLen(t){et(this.restEncoder,t)}}class Se extends ve{writeLeftID(t){et(this.restEncoder,t.client),et(this.restEncoder,t.clock)}writeRightID(t){et(this.restEncoder,t.client),et(this.restEncoder,t.clock)}writeClient(t){et(this.restEncoder,t)}writeInfo(t){tt(this.restEncoder,t)}writeString(t){it(this.restEncoder,t)}writeParentInfo(t){et(this.restEncoder,t?1:0)}writeTypeRef(t){et(this.restEncoder,t)}writeLen(t){et(this.restEncoder,t)}writeAny(t){lt(this.restEncoder,t)}writeBuf(t){ct(this.restEncoder,t)}writeJSON(t){it(this.restEncoder,JSON.stringify(t))}writeKey(t){it(this.restEncoder,t)}}class Ce{constructor(){this.restEncoder=X(),this.dsCurrVal=0}toUint8Array(){return Q(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,et(this.restEncoder,e)}writeDsLen(t){0===t&&bt(),et(this.restEncoder,t-1),this.dsCurrVal+=t}}class Ee extends Ce{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new gt,this.clientEncoder=new pt,this.leftClockEncoder=new gt,this.rightClockEncoder=new gt,this.infoEncoder=new ut(tt),this.stringEncoder=new yt,this.parentInfoEncoder=new ut(tt),this.typeRefEncoder=new pt,this.lenEncoder=new pt}toUint8Array(){const t=X();return et(t,0),ct(t,this.keyClockEncoder.toUint8Array()),ct(t,this.clientEncoder.toUint8Array()),ct(t,this.leftClockEncoder.toUint8Array()),ct(t,this.rightClockEncoder.toUint8Array()),ct(t,Q(this.infoEncoder)),ct(t,this.stringEncoder.toUint8Array()),ct(t,Q(this.parentInfoEncoder)),ct(t,this.typeRefEncoder.toUint8Array()),ct(t,this.lenEncoder.toUint8Array()),ot(t,Q(this.restEncoder)),Q(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){lt(this.restEncoder,t)}writeBuf(t){ct(this.restEncoder,t)}writeJSON(t){lt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Ae=(t,e,n)=>{const s=new Map;n.forEach(((t,n)=>{Ye(e,n)>t&&s.set(n,t)})),Ke(e).forEach(((t,e)=>{n.has(e)||s.set(e,0)})),et(t.restEncoder,s.size),h(s.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([n,s])=>{((t,e,n,s)=>{s=f(s,e[0].id.clock);const r=Xe(e,s);et(t.restEncoder,e.length-r),t.writeClient(n),et(t.restEncoder,s);const i=e[r];i.write(t,s-i.id.clock);for(let n=r+1;n<e.length;n++)e[n].write(t,0)})(t,e.clients.get(n),n,s)}))},De=(t,e,s,i=_e)=>{const o=St(e);((t,e,s,i=new _e(t))=>{an(e,(t=>{t.local=!1;let e=!1;const s=t.doc,o=s.store,c=((t,e)=>{const s=n(),r=At(t.restDecoder);for(let n=0;n<r;n++){const n=At(t.restDecoder),r=new Array(n),i=t.readClient();let o=At(t.restDecoder);s.set(i,{i:0,refs:r});for(let s=0;s<n;s++){const n=t.readInfo();switch(31&n){case 0:{const e=t.readLen();r[s]=new ys(Fe(i,o),e),o+=e;break}case 10:{const e=At(t.restDecoder);r[s]=new js(Fe(i,o),e),o+=e;break}default:{const c=0==(192&n),h=new Bs(Fe(i,o),null,(n&J)===J?t.readLeftID():null,null,(n&z)===z?t.readRightID():null,c?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,c&&32==(32&n)?t.readString():null,Us(t,n));r[s]=h,o+=h.length}}}}return s})(i,s),a=((t,e,n)=>{const s=[];let i=h(n.keys()).sort(((t,e)=>t-e));if(0===i.length)return null;const o=()=>{if(0===i.length)return null;let t=n.get(i[i.length-1]);for(;t.refs.length===t.i;){if(i.pop(),!(i.length>0))return null;t=n.get(i[i.length-1])}return t};let c=o();if(null===c&&0===s.length)return null;const a=new $e,l=new Map,u=(t,e)=>{const n=l.get(t);(null==n||n>e)&&l.set(t,e)};let d=c.refs[c.i++];const p=new Map,f=()=>{for(const t of s){const e=t.id.client,s=n.get(e);s?(s.i--,a.clients.set(e,s.refs.slice(s.i)),n.delete(e),s.i=0,s.refs=[]):a.clients.set(e,[t]),i=i.filter((t=>t!==e))}s.length=0};for(;;){if(d.constructor!==js){const i=r(p,d.id.client,(()=>Ye(e,d.id.client)))-d.id.clock;if(i<0)s.push(d),u(d.id.client,d.id.clock-1),f();else{const r=d.getMissing(t,e);if(null!==r){s.push(d);const t=n.get(r)||{refs:[],i:0};if(t.refs.length!==t.i){d=t.refs[t.i++];continue}u(r,Ye(e,r)),f()}else(0===i||i<d.length)&&(d.integrate(t,i),p.set(d.id.client,d.id.clock+d.length))}}if(s.length>0)d=s.pop();else if(null!==c&&c.i<c.refs.length)d=c.refs[c.i++];else{if(c=o(),null===c)break;d=c.refs[c.i++]}}if(a.clients.size>0){const t=new Ee;return Ae(t,a,new Map),et(t.restEncoder,0),{missing:l,update:t.toUint8Array()}}return null})(t,o,c),l=o.pendingStructs;if(l){for(const[t,n]of l.missing)if(n<Ye(o,t)){e=!0;break}if(a){for(const[t,e]of a.missing){const n=l.missing.get(t);(null==n||n>e)&&l.missing.set(t,e)}l.update=fn([l.update,a.update])}}else o.pendingStructs=a;const u=ge(i,t,o);if(o.pendingDs){const e=new _e(St(o.pendingDs));At(e.restDecoder);const n=ge(e,t,o);o.pendingDs=u&&n?fn([u,n]):u||n}else o.pendingDs=u;if(e){const e=o.pendingStructs.update;o.pendingStructs=null,De(t.doc,e)}}),s,!1)})(o,t,s,new i(o))},Oe=(t,e,n)=>De(t,e,n,be),Ne=(t,e=new Uint8Array([0]),n=new Ee)=>{((t,e,n=new Map)=>{Ae(t,e.store,n),pe(t,(t=>{const e=de();return t.clients.forEach(((t,n)=>{const s=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const r=n.id.clock;let i=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])i+=n.length;s.push(new oe(r,i))}}s.length>0&&e.clients.set(n,s)})),e})(e.store))})(n,t,Ie(e));const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(gn(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===Se)return dn(s.map(((t,e)=>0===e?t:bn(t))));if(n.constructor===Ee)return fn(s)}return s[0]},Te=(t,e)=>Ne(t,e,new Se),Ie=t=>(t=>{const e=new Map,n=At(t.restDecoder);for(let s=0;s<n;s++){const n=At(t.restDecoder),s=At(t.restDecoder);e.set(n,s)}return e})(new me(St(t))),Le=(t,e)=>(et(t.restEncoder,e.size),h(e.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{et(t.restEncoder,e),et(t.restEncoder,n)})),t),Re=t=>((t,e=new Ce)=>(t instanceof Map?Le(e,t):((t,e)=>{Le(t,Ke(e.store))})(e,t),e.toUint8Array()))(t,new ve);class xe{constructor(){this.l=[]}}const Me=()=>new xe,Be=(t,e)=>t.l.push(e),Ue=(t,e)=>{const n=t.l,s=n.length;t.l=n.filter((t=>e!==t)),s===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Pe=(t,e,n)=>T(t.l,[e,n]);class je{constructor(t,e){this.client=t,this.clock=e}}const qe=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,Fe=(t,e)=>new je(t,e);class He{constructor(t,e){this.ds=t,this.sv=e}}const Ve=(ze=de(),Je=new Map,new He(ze,Je),(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!ae(e.ds,t.id)),We=(t,e)=>{const n=r(t.meta,We,i),s=t.doc.store;n.has(e)||(e.sv.forEach(((e,n)=>{e<Ye(s,n)&&tn(t,Fe(n,e))})),he(t,e.ds,(t=>{})),n.add(e))};var ze,Je;class $e{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ke=t=>{const e=new Map;return t.clients.forEach(((t,n)=>{const s=t[t.length-1];e.set(n,s.id.clock+s.length)})),e},Ye=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const s=n[n.length-1];return s.id.clock+s.length},Ge=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw bt()}n.push(e)},Xe=(t,e)=>{let n=0,s=t.length-1,r=t[s],i=r.id.clock;if(i===e)return s;let o=u(e/(i+r.length-1)*s);for(;n<=s;){if(r=t[o],i=r.id.clock,i<=e){if(e<i+r.length)return o;n=o+1}else s=o-1;o=u((n+s)/2)}throw bt()},Qe=(t,e)=>{const n=t.clients.get(e.client);return n[Xe(n,e.clock)]},Ze=(t,e,n)=>{const s=Xe(e,n),r=e[s];return r.id.clock<n&&r instanceof Bs?(e.splice(s+1,0,Ms(t,r,n-r.id.clock)),s+1):s},tn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Ze(t,n,e.clock)]},en=(t,e,n)=>{const s=e.clients.get(n.client),r=Xe(s,n.clock),i=s[r];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ys&&s.splice(r+1,0,Ms(t,i,n.clock-i.id.clock+1)),i},nn=(t,e,n,s,r)=>{if(0===s)return;const i=n+s;let o,c=Ze(t,e,n);do{o=e[c++],i<o.id.clock+o.length&&Ze(t,e,i),r(o)}while(c<e.length&&e[c].id.clock<i)};class sn{constructor(t,e,n){this.doc=t,this.deleteSet=new ce,this.beforeState=Ke(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const rn=(t,e)=>!(0===e.deleteSet.clients.size&&!((t,n)=>{for(const[n,i]of t)if(s=i,r=n,e.beforeState.get(r)!==s)return!0;var s,r;return!1})(e.afterState)||(le(e.deleteSet),((t,e)=>{Ae(t,e.doc.store,e.beforeState)})(t,e),pe(t,e.deleteSet),0)),on=(t,e,n)=>{const s=e._item;(null===s||s.id.clock<(t.beforeState.get(s.id.client)||0)&&!s.deleted)&&r(t.changed,e,i).add(n)},cn=(t,e)=>{const n=t[e-1],s=t[e];n.deleted===s.deleted&&n.constructor===s.constructor&&n.mergeWith(s)&&(t.splice(e,1),s instanceof Bs&&null!==s.parentSub&&s.parent._map.get(s.parentSub)===s&&s.parent._map.set(s.parentSub,n))},hn=(t,e)=>{if(e<t.length){const n=t[e],s=n.doc,r=s.store,i=n.deleteSet,o=n._mergeStructs;try{le(i),n.afterState=Ke(n.doc.store),s.emit("beforeObserverCalls",[n,s]);const t=[];n.changed.forEach(((e,s)=>t.push((()=>{null!==s._item&&s._item.deleted||s._callObserver(n,e)})))),t.push((()=>{n.changedParentTypes.forEach(((e,s)=>t.push((()=>{null!==s._item&&s._item.deleted||((e=e.filter((t=>null===t.target._item||!t.target._item.deleted))).forEach((t=>{t.currentTarget=s})),e.sort(((t,e)=>t.path.length-e.path.length)),Pe(s._dEH,e,n))})))),t.push((()=>s.emit("afterTransaction",[n,s])))})),T(t,[])}finally{s.gc&&((t,e,n)=>{for(const[s,r]of t.clients.entries()){const t=e.clients.get(s);for(let s=r.length-1;s>=0;s--){const i=r[s],o=i.clock+i.len;for(let s=Xe(t,i.clock),r=t[s];s<t.length&&r.id.clock<o;r=t[++s]){const r=t[s];if(i.clock+i.len<=r.id.clock)break;r instanceof Bs&&r.deleted&&!r.keep&&n(r)&&r.gc(e,!1)}}}})(i,r,s.gcFilter),((t,e)=>{t.clients.forEach(((t,n)=>{const s=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=p(s.length-1,1+Xe(s,n.clock+n.len-1)),e=s[t];t>0&&e.id.clock>=n.clock;e=s[--t])cn(s,t)}}))})(i,r),n.afterState.forEach(((t,e)=>{const s=n.beforeState.get(e)||0;if(s!==t){const t=r.clients.get(e),n=f(Xe(t,s),1);for(let e=t.length-1;e>=n;e--)cn(t,e)}}));for(let t=0;t<o.length;t++){const{client:e,clock:n}=o[t].id,s=r.clients.get(e),i=Xe(s,n);i+1<s.length&&cn(s,i+1),i>0&&cn(s,i)}if(n.local||n.afterState.get(s.clientID)===n.beforeState.get(s.clientID)||(((...t)=>{console.log(...ne(t)),se.forEach((e=>e.print(t)))})(Zt,Jt,"[yjs] ",$t,Xt,"Changed the client-id because another client seems to be using it."),s.clientID=ye()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const t=new Se;rn(t,n)&&s.emit("update",[t.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const t=new Ee;rn(t,n)&&s.emit("updateV2",[t.toUint8Array(),n.origin,s,n])}const{subdocsAdded:c,subdocsLoaded:h,subdocsRemoved:a}=n;(c.size>0||a.size>0||h.size>0)&&(c.forEach((t=>{t.clientID=s.clientID,null==t.collectionid&&(t.collectionid=s.collectionid),s.subdocs.add(t)})),a.forEach((t=>s.subdocs.delete(t))),s.emit("subdocs",[{loaded:h,added:c,removed:a},s,n]),a.forEach((t=>t.destroy()))),t.length<=e+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,t])):hn(t,e+1)}}},an=(t,e,n=null,s=!0)=>{const r=t._transactionCleanups;let i=!1,o=null;null===t._transaction&&(i=!0,t._transaction=new sn(t,n,s),r.push(t._transaction),1===r.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const e=t._transaction===r[0];t._transaction=null,e&&hn(r,0)}}return o};class ln{constructor(t,e){this.gen=function*(t){const e=At(t.restDecoder);for(let n=0;n<e;n++){const e=At(t.restDecoder),n=t.readClient();let s=At(t.restDecoder);for(let r=0;r<e;r++){const e=t.readInfo();if(10===e){const e=At(t.restDecoder);yield new js(Fe(n,s),e),s+=e}else if(0!=(31&e)){const r=0==(192&e),i=new Bs(Fe(n,s),null,(e&J)===J?t.readLeftID():null,null,(e&z)===z?t.readRightID():null,r?t.readParentInfo()?t.readString():t.readLeftID():null,r&&32==(32&e)?t.readString():null,Us(t,e));yield i,s+=i.length}else{const e=t.readLen();yield new ys(Fe(n,s),e),s+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===js);return this.curr}}class un{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const dn=t=>fn(t,be,Se),pn=(t,e)=>{if(t.constructor===ys){const{client:n,clock:s}=t.id;return new ys(Fe(n,s+e),t.length-e)}if(t.constructor===js){const{client:n,clock:s}=t.id;return new js(Fe(n,s+e),t.length-e)}{const n=t,{client:s,clock:r}=n.id;return new Bs(Fe(s,r+e),null,Fe(s,r+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},fn=(t,e=_e,n=Ee)=>{if(1===t.length)return t[0];const s=t.map((t=>new e(St(t))));let r=s.map((t=>new ln(t,!0))),i=null;const o=new n,h=new un(o);for(;r=r.filter((t=>null!==t.curr)),r.sort(((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===js?1:-1:n}return e.curr.id.client-t.curr.id.client})),0!==r.length;){const t=r[0],e=t.curr.id.client;if(null!==i){let n=t.curr,s=!1;for(;null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client;)n=t.next(),s=!0;if(null===n||n.id.client!==e||s&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(e!==i.struct.id.client)wn(h,i.struct,i.offset),i={struct:n,offset:0},t.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===js)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{wn(h,i.struct,i.offset);const t=n.id.clock-i.struct.id.clock-i.struct.length;i={struct:new js(Fe(e,i.struct.id.clock+i.struct.length),t),offset:0}}else{const e=i.struct.id.clock+i.struct.length-n.id.clock;e>0&&(i.struct.constructor===js?i.struct.length-=e:n=pn(n,e)),i.struct.mergeWith(n)||(wn(h,i.struct,i.offset),i={struct:n,offset:0},t.next())}}else i={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==js;n=t.next())wn(h,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(wn(h,i.struct,i.offset),i=null),mn(h);const a=(t=>{const e=new ce;for(let n=0;n<t.length;n++)t[n].clients.forEach(((s,r)=>{if(!e.clients.has(r)){const i=s.slice();for(let e=n+1;e<t.length;e++)c(i,t[e].clients.get(r)||[]);e.clients.set(r,i)}}));return le(e),e})(s.map((t=>fe(t))));return pe(o,a),o.toUint8Array()},gn=(t,e,n=_e,s=Ee)=>{const r=Ie(e),i=new s,o=new un(i),c=new n(St(t)),h=new ln(c,!1);for(;h.curr;){const t=h.curr,e=t.id.client,n=r.get(e)||0;if(h.curr.constructor!==js)if(t.id.clock+t.length>n)for(wn(o,t,f(n-t.id.clock,0)),h.next();h.curr&&h.curr.id.client===e;)wn(o,h.curr,0),h.next();else for(;h.curr&&h.curr.id.client===e&&h.curr.id.clock+h.curr.length<=n;)h.next();else h.next()}mn(o);const a=fe(c);return pe(i,a),i.toUint8Array()},yn=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Q(t.encoder.restEncoder)}),t.encoder.restEncoder=X(),t.written=0)},wn=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&yn(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),et(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},mn=t=>{yn(t);const e=t.encoder.restEncoder;et(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const s=t.clientStructs[n];et(e,s.written),ot(e,s.restEncoder)}},bn=t=>((t,e,n,s)=>{const r=new n(St(t)),i=new ln(r,!1),o=new s,c=new un(o);for(let t=i.curr;null!==t;t=i.next())wn(c,e(t),0);mn(c);const h=fe(r);return pe(o,h),o.toUint8Array()})(t,I,_e,Se);class kn{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return _n(this.currentTarget,this.target)}deletes(t){return ae(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach((n=>{if(null!==n){const s=e._map.get(n);let r,i;if(this.adds(s)){let t=s.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(s)){if(null===t||!this.deletes(t))return;r="delete",i=o(t.content.getContent())}else null!==t&&this.deletes(t)?(r="update",i=o(t.content.getContent())):(r="add",i=void 0)}else{if(!this.deletes(s))return;r="delete",i=o(s.content.getContent())}t.set(n,{action:r,oldValue:i})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){const e=this.target,n=i(),s=i(),r=[];if(t={added:n,deleted:s,delta:r,keys:this.keys},this.transaction.changed.get(e).has(null)){let t=null;const i=()=>{t&&r.push(t)};for(let r=e._start;null!==r;r=r.right)r.deleted?this.deletes(r)&&!this.adds(r)&&(null!==t&&void 0!==t.delete||(i(),t={delete:0}),t.delete+=r.length,s.add(r)):this.adds(r)?(null!==t&&void 0!==t.insert||(i(),t={insert:[]}),t.insert=t.insert.concat(r.content.getContent()),n.add(r)):(null!==t&&void 0!==t.retain||(i(),t={retain:0}),t.retain+=r.length);null!==t&&void 0===t.retain&&i()}this._changes=t}return t}}const _n=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,s=e._item.parent._start;for(;s!==e._item&&null!==s;)s.deleted||t++,s=s.right;n.unshift(t)}e=e._item.parent}return n};let vn=0;class Sn{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=vn++}}const Cn=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=vn++},En=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,n)=>d(e-t.index)<d(e-n.index)?t:n));let s=t._start,r=0;for(null!==n&&(s=n.p,r=n.index,(t=>{t.timestamp=vn++})(n));null!==s.right&&r<e;){if(!s.deleted&&s.countable){if(e<r+s.length)break;r+=s.length}s=s.right}for(;null!==s.left&&r>e;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);for(;null!==s.left&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);return null!==n&&d(n.index-r)<s.parent.length/80?(Cn(n,s,r),n):((t,e,n)=>{if(t.length>=80){const s=t.reduce(((t,e)=>t.timestamp<e.timestamp?t:e));return Cn(s,e,n),s}{const s=new Sn(e,n);return t.push(s),s}})(t._searchMarker,s,r)},An=(t,e,n)=>{for(let s=t.length-1;s>=0;s--){const r=t[s];if(n>0){let e=r.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(r.index-=e.length);if(null===e||!0===e.marker){t.splice(s,1);continue}r.p=e,e.marker=!0}(e<r.index||n>0&&e===r.index)&&(r.index=f(e,r.index+n))}},Dn=(t,e,n)=>{const s=t,i=e.changedParentTypes;for(;r(i,t,(()=>[])).push(n),null!==t._item;)t=t._item.parent;Pe(s._eH,n,e)};class On{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Me(),this._dEH=Me(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw mt()}clone(){throw mt()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Be(this._eH,t)}observeDeep(t){Be(this._dEH,t)}unobserve(t){Ue(this._eH,t)}unobserveDeep(t){Ue(this._dEH,t)}toJSON(){}}const Nn=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let s=n-e;const r=[];let i=t._start;for(;null!==i&&s>0;){if(i.countable&&!i.deleted){const t=i.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&s>0;n++)r.push(t[n]),s--;e=0}}i=i.right}return r},Tn=t=>{const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},In=(t,e)=>{let n=0,s=t._start;for(;null!==s;){if(s.countable&&!s.deleted){const r=s.content.getContent();for(let s=0;s<r.length;s++)e(r[s],n++,t)}s=s.right}},Ln=(t,e)=>{const n=[];return In(t,((s,r)=>{n.push(e(s,r,t))})),n},Rn=t=>{let e=t._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),s=0,e=e.right}const t=n[s++];return n.length<=s&&(n=null),{done:!1,value:t}}}},xn=(t,e)=>{const n=En(t,e);let s=t._start;for(null!==n&&(s=n.p,e-=n.index);null!==s;s=s.right)if(!s.deleted&&s.countable){if(e<s.length)return s.content.getContent()[e];e-=s.length}},Mn=(t,e,n,s)=>{let r=n;const i=t.doc,o=i.clientID,c=i.store,h=null===n?e._start:n.right;let a=[];const l=()=>{a.length>0&&(r=new Bs(Fe(o,Ye(c,o)),r,r&&r.lastId,h,h&&h.id,e,null,new Cs(a)),r.integrate(t,0),a=[])};s.forEach((n=>{if(null===n)a.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(n);break;default:switch(l(),n.constructor){case Uint8Array:case ArrayBuffer:r=new Bs(Fe(o,Ye(c,o)),r,r&&r.lastId,h,h&&h.id,e,null,new ws(new Uint8Array(n))),r.integrate(t,0);break;case we:r=new Bs(Fe(o,Ye(c,o)),r,r&&r.lastId,h,h&&h.id,e,null,new ks(n)),r.integrate(t,0);break;default:if(!(n instanceof On))throw new Error("Unexpected content type in insert operation");r=new Bs(Fe(o,Ye(c,o)),r,r&&r.lastId,h,h&&h.id,e,null,new xs(n)),r.integrate(t,0)}}})),l()},Bn=wt("Length exceeded!"),Un=(t,e,n,s)=>{if(n>e._length)throw Bn;if(0===n)return e._searchMarker&&An(e._searchMarker,n,s.length),Mn(t,e,null,s);const r=n,i=En(e,n);let o=e._start;for(null!==i&&(o=i.p,0==(n-=i.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&tn(t,Fe(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&An(e._searchMarker,r,s.length),Mn(t,e,o,s)},Pn=(t,e,n,s)=>{if(0===s)return;const r=n,i=s,o=En(e,n);let c=e._start;for(null!==o&&(c=o.p,n-=o.index);null!==c&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&tn(t,Fe(c.id.client,c.id.clock+n)),n-=c.length);for(;s>0&&null!==c;)c.deleted||(s<c.length&&tn(t,Fe(c.id.client,c.id.clock+s)),c.delete(t),s-=c.length),c=c.right;if(s>0)throw Bn;e._searchMarker&&An(e._searchMarker,r,-i+s)},jn=(t,e,n)=>{const s=e._map.get(n);void 0!==s&&s.delete(t)},qn=(t,e,n,s)=>{const r=e._map.get(n)||null,i=t.doc,o=i.clientID;let c;if(null==s)c=new Cs([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:c=new Cs([s]);break;case Uint8Array:c=new ws(s);break;case we:c=new ks(s);break;default:if(!(s instanceof On))throw new Error("Unexpected content type");c=new xs(s)}new Bs(Fe(o,Ye(i.store,o)),r,r&&r.lastId,null,null,e,n,c).integrate(t,0)},Fn=(t,e)=>{const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Hn=t=>{const e={};return t._map.forEach(((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])})),e},Vn=(t,e)=>{const n=t._map.get(e);return void 0!==n&&!n.deleted},Wn=t=>{return e=t.entries(),n=t=>!t[1].deleted,re((()=>{let t;do{t=e.next()}while(!t.done&&!n(t.value));return t}));var e,n};class zn extends kn{constructor(t,e){super(t,e),this._transaction=e}}class Jn extends On{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Jn;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Jn}clone(){const t=new Jn;return t.insert(0,this.toArray().map((t=>t instanceof On?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Dn(this,t,new zn(this,t))}insert(t,e){null!==this.doc?an(this.doc,(n=>{Un(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?an(this.doc,(e=>{((t,e,n)=>{let s=(e._searchMarker||[]).reduce(((t,e)=>e.index>t.index?e:t),{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;Mn(t,e,s,n)})(e,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?an(this.doc,(n=>{Pn(n,this,t,e)})):this._prelimContent.splice(t,e)}get(t){return xn(this,t)}toArray(){return Tn(this)}slice(t=0,e=this.length){return Nn(this,t,e)}toJSON(){return this.map((t=>t instanceof On?t.toJSON():t))}map(t){return Ln(this,t)}forEach(t){In(this,t)}[Symbol.iterator](){return Rn(this)}_write(t){t.writeTypeRef(Ds)}}class $n extends kn{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Kn extends On{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach(((t,e)=>{this.set(e,t)})),this._prelimContent=null}_copy(){return new Kn}clone(){const t=new Kn;return this.forEach(((e,n)=>{t.set(n,e instanceof On?e.clone():e)})),t}_callObserver(t,e){Dn(this,t,new $n(this,t,e))}toJSON(){const t={};return this._map.forEach(((e,n)=>{if(!e.deleted){const s=e.content.getContent()[e.length-1];t[n]=s instanceof On?s.toJSON():s}})),t}get size(){return[...Wn(this._map)].length}keys(){return ie(Wn(this._map),(t=>t[0]))}values(){return ie(Wn(this._map),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return ie(Wn(this._map),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this._map.forEach(((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?an(this.doc,(e=>{jn(e,this,t)})):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?an(this.doc,(n=>{qn(n,this,t,e)})):this._prelimContent.set(t,e),e}get(t){return Fn(this,t)}has(t){return Vn(this,t)}clear(){null!==this.doc?an(this.doc,(t=>{this.forEach((function(e,n,s){jn(t,s,n)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(Os)}}const Yn=(t,e)=>t===e||"object"==typeof t&&"object"==typeof e&&t&&e&&((t,e)=>t===e||O(t)===O(e)&&((t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0})(t,((t,n)=>(void 0!==t||N(e,n))&&e[n]===t)))(t,e);class Gn{constructor(t,e,n,s){this.left=t,this.right=e,this.index=n,this.currentAttributes=s}forward(){null===this.right&&bt(),this.right.content.constructor===vs?this.right.deleted||ts(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const Xn=(t,e,n)=>{for(;null!==e.right&&n>0;)e.right.content.constructor===vs?e.right.deleted||ts(e.currentAttributes,e.right.content):e.right.deleted||(n<e.right.length&&tn(t,Fe(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length),e.left=e.right,e.right=e.right.right;return e},Qn=(t,e,n)=>{const s=new Map,r=En(e,n);if(r){const e=new Gn(r.p.left,r.p,r.index,s);return Xn(t,e,n-r.index)}{const r=new Gn(null,e._start,0,s);return Xn(t,r,n)}},Zn=(t,e,n,s)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===vs&&Yn(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const r=t.doc,i=r.clientID;s.forEach(((s,o)=>{const c=n.left,h=n.right,a=new Bs(Fe(i,Ye(r.store,i)),c,c&&c.lastId,h,h&&h.id,e,null,new vs(o,s));a.integrate(t,0),n.right=a,n.forward()}))},ts=(t,e)=>{const{key:n,value:s}=e;null===s?t.delete(n):t.set(n,s)},es=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===vs&&Yn(e[t.right.content.key]||null,t.right.content.value));)t.forward()},ns=(t,e,n,s)=>{const r=t.doc,i=r.clientID,o=new Map;for(const c in s){const h=s[c],a=n.currentAttributes.get(c)||null;if(!Yn(a,h)){o.set(c,a);const{left:s,right:l}=n;n.right=new Bs(Fe(i,Ye(r.store,i)),s,s&&s.lastId,l,l&&l.id,e,null,new vs(c,h)),n.right.integrate(t,0),n.forward()}}return o},ss=(t,e,n,s,r)=>{n.currentAttributes.forEach(((t,e)=>{void 0===r[e]&&(r[e]=null)}));const i=t.doc,o=i.clientID;es(n,r);const c=ns(t,e,n,r),h=s.constructor===String?new Es(s):s instanceof On?new xs(s):new _s(s);let{left:a,right:l,index:u}=n;e._searchMarker&&An(e._searchMarker,n.index,h.getLength()),l=new Bs(Fe(o,Ye(i.store,o)),a,a&&a.lastId,l,l&&l.id,e,null,h),l.integrate(t,0),n.right=l,n.index=u,n.forward(),Zn(t,e,n,c)},rs=(t,e,n,s,r)=>{const i=t.doc,o=i.clientID;es(n,r);const c=ns(t,e,n,r);t:for(;null!==n.right&&(s>0||c.size>0&&(n.right.deleted||n.right.content.constructor===vs));){if(!n.right.deleted)switch(n.right.content.constructor){case vs:{const{key:e,value:i}=n.right.content,o=r[e];if(void 0!==o){if(Yn(o,i))c.delete(e);else{if(0===s)break t;c.set(e,i)}n.right.delete(t)}else n.currentAttributes.set(e,i);break}default:s<n.right.length&&tn(t,Fe(n.right.id.client,n.right.id.clock+s)),s-=n.right.length}n.forward()}if(s>0){let r="";for(;s>0;s--)r+="\n";n.right=new Bs(Fe(o,Ye(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Es(r)),n.right.integrate(t,0),n.forward()}Zn(t,e,n,c)},is=(t,e,s,r,i)=>{let o=e;const c=n();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===vs){const t=o.content;c.set(t.key,t)}o=o.right}let h=0,a=!1;for(;e!==o;){if(s===e&&(a=!0),!e.deleted){const n=e.content;switch(n.constructor){case vs:{const{key:s,value:o}=n,l=r.get(s)||null;c.get(s)===n&&l!==o||(e.delete(t),h++,a||(i.get(s)||null)!==o||l===o||(null===l?i.delete(s):i.set(s,l))),a||e.deleted||ts(i,n);break}}}e=e.right}return h},os=(t,e,n)=>{const r=n,i=s(e.currentAttributes),o=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case xs:case _s:case Es:n<e.right.length&&tn(t,Fe(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}o&&is(t,o,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&An(c._searchMarker,e.index,-r+n),e};class cs extends kn{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];an(t,(t=>{const n=new Map,s=new Map;let r=this.target._start,i=null;const o={};let c="",h=0,a=0;const l=()=>{if(null!==i){let t=null;switch(i){case"delete":a>0&&(t={delete:a}),a=0;break;case"insert":("object"==typeof c||c.length>0)&&(t={insert:c},n.size>0&&(t.attributes={},n.forEach(((e,n)=>{null!==e&&(t.attributes[n]=e)})))),c="";break;case"retain":h>0&&(t={retain:h},(t=>{for(const e in t)return!1;return!0})(o)||(t.attributes=A({},o))),h=0}t&&e.push(t),i=null}};for(;null!==r;){switch(r.content.constructor){case xs:case _s:this.adds(r)?this.deletes(r)||(l(),i="insert",c=r.content.getContent()[0],l()):this.deletes(r)?("delete"!==i&&(l(),i="delete"),a+=1):r.deleted||("retain"!==i&&(l(),i="retain"),h+=1);break;case Es:this.adds(r)?this.deletes(r)||("insert"!==i&&(l(),i="insert"),c+=r.content.str):this.deletes(r)?("delete"!==i&&(l(),i="delete"),a+=r.length):r.deleted||("retain"!==i&&(l(),i="retain"),h+=r.length);break;case vs:{const{key:e,value:c}=r.content;if(this.adds(r)){if(!this.deletes(r)){const h=n.get(e)||null;Yn(h,c)?null!==c&&r.delete(t):("retain"===i&&l(),Yn(c,s.get(e)||null)?delete o[e]:o[e]=c)}}else if(this.deletes(r)){s.set(e,c);const t=n.get(e)||null;Yn(t,c)||("retain"===i&&l(),o[e]=t)}else if(!r.deleted){s.set(e,c);const n=o[e];void 0!==n&&(Yn(n,c)?null!==n&&r.delete(t):("retain"===i&&l(),null===c?delete o[e]:o[e]=c))}r.deleted||("insert"===i&&l(),ts(n,r.content));break}}r=r.right}for(l();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}})),this._delta=e}return this._delta}}class hs extends On{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach((t=>t()))}catch(t){console.error(t)}this._pending=null}_copy(){return new hs}clone(){const t=new hs;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const r=new cs(this,t,e),i=t.doc;if(Dn(this,t,r),!t.local){let e=!1;for(const[n,s]of t.afterState.entries()){const r=t.beforeState.get(n)||0;if(s!==r&&(nn(t,i.store.clients.get(n),r,s,(t=>{t.deleted||t.content.constructor!==vs||(e=!0)})),e))break}e||he(t,t.deleteSet,(t=>{t instanceof ys||e||t.parent===this&&t.content.constructor===vs&&(e=!0)})),an(i,(t=>{e?(t=>{let e=0;an(t.doc,(r=>{let i=t._start,o=t._start,c=n();const h=s(c);for(;o;)!1===o.deleted&&(o.content.constructor===vs?ts(h,o.content):(e+=is(r,i,o,c,h),c=s(h),i=o)),o=o.right}))})(this):he(t,t.deleteSet,(e=>{e instanceof ys||e.parent===this&&((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===vs){const s=e.content.key;n.has(s)?e.delete(t):n.add(s)}e=e.left}})(t,e)}))}))}}toString(){let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===Es&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?an(this.doc,(n=>{const s=new Gn(null,this._start,0,new Map);for(let r=0;r<t.length;r++){const i=t[r];if(void 0!==i.insert){const o=e||"string"!=typeof i.insert||r!==t.length-1||null!==s.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof o||o.length>0)&&ss(n,this,s,o,i.attributes||{})}else void 0!==i.retain?rs(n,this,s,i.retain,i.attributes||{}):void 0!==i.delete&&os(n,s,i.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,e,n){const s=[],r=new Map,i=this.doc;let o="",c=this._start;function h(){if(o.length>0){const t={};let e=!1;r.forEach(((n,s)=>{e=!0,t[s]=n}));const n={insert:o};e&&(n.attributes=t),s.push(n),o=""}}const a=()=>{for(;null!==c;){if(Ve(c,t)||void 0!==e&&Ve(c,e))switch(c.content.constructor){case Es:{const s=r.get("ychange");void 0===t||Ve(c,t)?void 0===e||Ve(c,e)?void 0!==s&&(h(),r.delete("ychange")):void 0!==s&&s.user===c.id.client&&"added"===s.type||(h(),r.set("ychange",n?n("added",c.id):{type:"added"})):void 0!==s&&s.user===c.id.client&&"removed"===s.type||(h(),r.set("ychange",n?n("removed",c.id):{type:"removed"})),o+=c.content.str;break}case xs:case _s:{h();const t={insert:c.content.getContent()[0]};if(r.size>0){const e={};t.attributes=e,r.forEach(((t,n)=>{e[n]=t}))}s.push(t);break}case vs:Ve(c,t)&&(h(),ts(r,c.content))}c=c.right}h()};return t||e?an(i,(n=>{t&&We(n,t),e&&We(n,e),a()}),"cleanup"):a(),s}insert(t,e,n){if(e.length<=0)return;const s=this.doc;null!==s?an(s,(s=>{const r=Qn(s,this,t);n||(n={},r.currentAttributes.forEach(((t,e)=>{n[e]=t}))),ss(s,this,r,e,n)})):this._pending.push((()=>this.insert(t,e,n)))}insertEmbed(t,e,n={}){const s=this.doc;null!==s?an(s,(s=>{const r=Qn(s,this,t);ss(s,this,r,e,n)})):this._pending.push((()=>this.insertEmbed(t,e,n)))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?an(n,(n=>{os(n,Qn(n,this,t),e)})):this._pending.push((()=>this.delete(t,e)))}format(t,e,n){if(0===e)return;const s=this.doc;null!==s?an(s,(s=>{const r=Qn(s,this,t);null!==r.right&&rs(s,this,r,e,n)})):this._pending.push((()=>this.format(t,e,n)))}removeAttribute(t){null!==this.doc?an(this.doc,(e=>{jn(e,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,e){null!==this.doc?an(this.doc,(n=>{qn(n,this,t,e)})):this._pending.push((()=>this.setAttribute(t,e)))}getAttribute(t){return Fn(this,t)}getAttributes(){return Hn(this)}_write(t){t.writeTypeRef(Ns)}}class as{constructor(t,e=(()=>!0)){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==us&&e.constructor!==ls||null===e._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ls extends On{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ls}clone(){const t=new ls;return t.insert(0,this.toArray().map((t=>t instanceof On?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new as(this,t)}querySelector(t){t=t.toUpperCase();const e=new as(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),h(new as(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)))}_callObserver(t,e){Dn(this,t,new ds(this,e,t))}toString(){return Ln(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const s=t.createDocumentFragment();return void 0!==n&&n._createAssociation(s,this),In(this,(r=>{s.insertBefore(r.toDOM(t,e,n),null)})),s}insert(t,e){null!==this.doc?an(this.doc,(n=>{Un(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)an(this.doc,(n=>{const s=t&&t instanceof On?t._item:t;Mn(n,this,s,e)}));else{const n=this._prelimContent,s=null===t?0:n.findIndex((e=>e===t))+1;if(0===s&&null!==t)throw wt("Reference item not found");n.splice(s,0,...e)}}delete(t,e=1){null!==this.doc?an(this.doc,(n=>{Pn(n,this,t,e)})):this._prelimContent.splice(t,e)}toArray(){return Tn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return xn(this,t)}slice(t=0,e=this.length){return Nn(this,t,e)}forEach(t){In(this,t)}_write(t){t.writeTypeRef(Is)}}class us extends ls{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach(((t,e)=>{this.setAttribute(e,t)})),this._prelimAttrs=null}_copy(){return new us(this.nodeName)}clone(){const t=new us(this.nodeName);return((t,e)=>{for(const n in t)e(t[n],n)})(this.getAttributes(),((e,n)=>{"string"==typeof e&&t.setAttribute(n,e)})),t.insert(0,this.toArray().map((t=>t instanceof On?t.clone():t))),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const e in t)n.push(e);n.sort();const s=n.length;for(let r=0;r<s;r++){const s=n[r];e.push(s+'="'+t[s]+'"')}const r=this.nodeName.toLocaleLowerCase();return`<${r}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${r}>`}removeAttribute(t){null!==this.doc?an(this.doc,(e=>{jn(e,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?an(this.doc,(n=>{qn(n,this,t,e)})):this._prelimAttrs.set(t,e)}getAttribute(t){return Fn(this,t)}hasAttribute(t){return Vn(this,t)}getAttributes(){return Hn(this)}toDOM(t=document,e={},n){const s=t.createElement(this.nodeName),r=this.getAttributes();for(const t in r){const e=r[t];"string"==typeof e&&s.setAttribute(t,e)}return In(this,(r=>{s.appendChild(r.toDOM(t,e,n))})),void 0!==n&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ts),t.writeKey(this.nodeName)}}class ds extends kn{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class ps extends Kn{constructor(t){super(),this.hookName=t}_copy(){return new ps(this.hookName)}clone(){const t=new ps(this.hookName);return this.forEach(((e,n)=>{t.set(n,e)})),t}toDOM(t=document,e={},n){const s=e[this.hookName];let r;return r=void 0!==s?s.createDom(this):document.createElement(this.hookName),r.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(Ls),t.writeKey(this.hookName)}}class fs extends hs{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new fs}clone(){const t=new fs;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const s=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(s,this),s}toString(){return this.toDelta().map((t=>{const e=[];for(const n in t.attributes){const s=[];for(const e in t.attributes[n])s.push({key:e,value:t.attributes[n][e]});s.sort(((t,e)=>t.key<e.key?-1:1)),e.push({nodeName:n,attrs:s})}e.sort(((t,e)=>t.nodeName<e.nodeName?-1:1));let n="";for(let t=0;t<e.length;t++){const s=e[t];n+=`<${s.nodeName}`;for(let t=0;t<s.attrs.length;t++){const e=s.attrs[t];n+=` ${e.key}="${e.value}"`}n+=">"}n+=t.insert;for(let t=e.length-1;t>=0;t--)n+=`</${e[t].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Rs)}}class gs{constructor(t,e){this.id=t,this.length=e}get deleted(){throw mt()}mergeWith(t){return!1}write(t,e,n){throw mt()}integrate(t,e){throw mt()}}class ys extends gs{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Ge(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class ws{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ws(this.content)}splice(t){throw mt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class ms{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ms(this.len)}splice(t){const e=new ms(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){ue(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const bs=(t,e)=>new we({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class ks{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ks(bs(this.doc.guid,this.opts))}splice(t){throw mt()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class _s{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new _s(this.embed)}splice(t){throw mt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class vs{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new vs(this.key,this.value)}splice(t){throw mt()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class Ss{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ss(this.arr)}splice(t){const e=new Ss(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let s=e;s<n;s++){const e=this.arr[s];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}class Cs{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cs(this.arr)}splice(t){const e=new Cs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let s=e;s<n;s++){const e=this.arr[s];t.writeAny(e)}}getRef(){return 8}}class Es{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Es(this.str)}splice(t){const e=new Es(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const As=[t=>new Jn,t=>new Kn,t=>new hs,t=>new us(t.readKey()),t=>new ls,t=>new ps(t.readKey()),t=>new fs],Ds=0,Os=1,Ns=2,Ts=3,Is=4,Ls=5,Rs=6;class xs{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new xs(this.type._copy())}splice(t){throw mt()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach((e=>{e.deleted?t._mergeStructs.push(e):e.delete(t)})),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach((e=>{for(;null!==e;)e.gc(t,!0),e=e.left})),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Ms=(t,e,n)=>{const{client:s,clock:r}=e.id,i=new Bs(Fe(s,r+n),e,Fe(s,r+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),null!==e.redone&&(i.redone=Fe(e.redone.client,e.redone.clock+n)),e.right=i,null!==i.right&&(i.right.left=i),t._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Bs extends gs{constructor(t,e,n,s,r,i,o,c){super(t,c.getLength()),this.origin=n,this.left=e,this.right=s,this.rightOrigin=r,this.parent=i,this.parentSub=o,this.redone=null,this.content=c,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ye(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ye(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===je&&this.id.client!==this.parent.client&&this.parent.clock>=Ye(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=en(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=tn(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===ys||this.right&&this.right.constructor===ys)&&(this.parent=null),this.parent){if(this.parent.constructor===je){const t=Qe(e,this.parent);t.constructor===ys?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Bs&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Bs&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=en(t,t.doc.store,Fe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const s=new Set,r=new Set;for(;null!==e&&e!==this.right;){if(r.add(e),s.add(e),qe(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,s.clear();else if(qe(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!r.has(Qe(t.doc.store,e.origin)))break;s.has(Qe(t.doc.store,e.origin))||(n=e,s.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ge(t.doc.store,this),this.content.integrate(t,this),on(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new ys(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:Fe(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&qe(t.origin,this.lastId)&&this.right===t&&qe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach((e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),ue(t.deleteSet,this.id.client,this.id.clock,this.length),on(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw bt();this.content.gc(t),e?((t,e,n)=>{const s=t.clients.get(e.id.client);s[Xe(s,e.id.clock)]=n})(t,this,new ys(this.id,this.length)):this.content=new ms(this.length)}write(t,e){const n=e>0?Fe(this.id.client,this.id.clock+e-1):this.origin,s=this.rightOrigin,r=this.parentSub,i=31&this.content.getRef()|(null===n?0:J)|(null===s?0:z)|(null===r?0:32);if(t.writeInfo(i),null!==n&&t.writeLeftID(n),null!==s&&t.writeRightID(s),null===n&&null===s){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=(t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw bt()})(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===je?(t.writeParentInfo(!1),t.writeLeftID(e)):bt();null!==r&&t.writeString(r)}this.content.write(t,e)}}const Us=(t,e)=>Ps[31&e](t),Ps=[()=>{bt()},t=>new ms(t.readLen()),t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new Ss(n)},t=>new ws(t.readBuf()),t=>new Es(t.readString()),t=>new _s(t.readJSON()),t=>new vs(t.readKey(),t.readJSON()),t=>new xs(As[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let s=0;s<e;s++)n.push(t.readAny());return new Cs(n)},t=>new ks(bs(t.readString(),t.readAny())),()=>{bt()}];class js extends gs{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){bt()}write(t,e){t.writeInfo(10),et(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const qs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},Fs="__ $YJS$ __";!0===qs[Fs]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),qs[Fs]=!0;const Hs=new Map,Vs="undefined"==typeof BroadcastChannel?class{constructor(t){var e;this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&null!==this.onmessage&&this.onmessage({data:W(e.newValue||"")}),e=this._onChange,C||addEventListener("storage",e)}postMessage(t){E.setItem(this.room,V(new Uint8Array(t)))}close(){var t;t=this._onChange,C||removeEventListener("storage",t)}}:BroadcastChannel,Ws=t=>r(Hs,t,(()=>{const e=i(),n=new Vs(t);return n.onmessage=t=>e.forEach((e=>e(t.data,"broadcastchannel"))),{bc:n,subs:e}})),zs=(t,e,n=null)=>{const s=Ws(t);s.bc.postMessage(e),s.subs.forEach((t=>t(e,n)))};class Js extends l{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const t=zt();null!==this.getLocalState()&&15e3<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach(((n,s)=>{s!==this.clientID&&3e4<=t-n.lastUpdated&&this.states.has(s)&&e.push(s)})),e.length>0&&$s(this,e,"timeout")}),u(3e3)),t.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),s=void 0===n?0:n.clock+1,r=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:s,lastUpdated:zt()});const i=[],o=[],c=[],h=[];null===t?h.push(e):null==r?null!=t&&i.push(e):(o.push(e),L(r,t)||c.push(e)),(i.length>0||c.length>0||h.length>0)&&this.emit("change",[{added:i,updated:c,removed:h},"local"]),this.emit("update",[{added:i,updated:o,removed:h},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const $s=(t,e,n)=>{const s=[];for(let n=0;n<e.length;n++){const r=e[n];if(t.states.has(r)){if(t.states.delete(r),r===t.clientID){const e=t.meta.get(r);t.meta.set(r,{clock:e.clock+1,lastUpdated:zt()})}s.push(r)}}s.length>0&&(t.emit("change",[{added:[],updated:[],removed:s},n]),t.emit("update",[{added:[],updated:[],removed:s},n]))},Ks=(t,e,n=t.states)=>{const s=e.length,r=X();et(r,s);for(let i=0;i<s;i++){const s=e[i],o=n.get(s)||null,c=t.meta.get(s).clock;et(r,s),et(r,c),it(r,JSON.stringify(o))}return Q(r)},Ys=(t,e,n)=>{const s=St(e),r=zt(),i=[],o=[],c=[],h=[],a=At(s);for(let e=0;e<a;e++){const e=At(s);let n=At(s);const a=JSON.parse(Ot(s)),l=t.meta.get(e),u=t.states.get(e),d=void 0===l?0:l.clock;(d<n||d===n&&null===a&&t.states.has(e))&&(null===a?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,a),t.meta.set(e,{clock:n,lastUpdated:r}),void 0===l&&null!==a?i.push(e):void 0!==l&&null===a?h.push(e):null!==a&&(L(a,u)||c.push(e),o.push(e)))}(i.length>0||c.length>0||h.length>0)&&t.emit("change",[{added:i,updated:c,removed:h},n]),(i.length>0||o.length>0||h.length>0)&&t.emit("update",[{added:i,updated:o,removed:h},n])},Gs=Object.create(null);Gs.open="0",Gs.close="1",Gs.ping="2",Gs.pong="3",Gs.message="4",Gs.upgrade="5",Gs.noop="6";const Xs=Object.create(null);Object.keys(Gs).forEach((t=>{Xs[Gs[t]]=t}));const Qs={type:"error",data:"parser error"},Zs="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),tr="function"==typeof ArrayBuffer,er=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+t)},n.readAsDataURL(t)},nr=({type:t,data:e},n,s)=>{return Zs&&e instanceof Blob?n?s(e):er(e,s):tr&&(e instanceof ArrayBuffer||(r=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?n?s(e):er(new Blob([e]),s):s(Gs[t]+(e||""));var r},sr="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)sr["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const rr="function"==typeof ArrayBuffer,ir=(t,e)=>{if(rr){const n=(t=>{let e,n,s,r,i,o=.75*t.length,c=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const a=new ArrayBuffer(o),l=new Uint8Array(a);for(e=0;e<c;e+=4)n=sr[t.charCodeAt(e)],s=sr[t.charCodeAt(e+1)],r=sr[t.charCodeAt(e+2)],i=sr[t.charCodeAt(e+3)],l[h++]=n<<2|s>>4,l[h++]=(15&s)<<4|r>>2,l[h++]=(3&r)<<6|63&i;return a})(t);return or(n,e)}return{base64:!0,data:t}},or=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t,cr=(t,e)=>{if("string"!=typeof t)return{type:"message",data:or(t,e)};const n=t.charAt(0);return"b"===n?{type:"message",data:ir(t.substring(1),e)}:Xs[n]?t.length>1?{type:Xs[n],data:t.substring(1)}:{type:Xs[n]}:Qs},hr=String.fromCharCode(30);function ar(t){if(t)return function(t){for(var e in ar.prototype)t[e]=ar.prototype[e];return t}(t)}ar.prototype.on=ar.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},ar.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},ar.prototype.off=ar.prototype.removeListener=ar.prototype.removeAllListeners=ar.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r=0;r<s.length;r++)if((n=s[r])===e||n.fn===e){s.splice(r,1);break}return 0===s.length&&delete this._callbacks["$"+t],this},ar.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(n){s=0;for(var r=(n=n.slice(0)).length;s<r;++s)n[s].apply(this,e)}return this},ar.prototype.emitReserved=ar.prototype.emit,ar.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},ar.prototype.hasListeners=function(t){return!!this.listeners(t).length};const lr="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function ur(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}const dr=lr.setTimeout,pr=lr.clearTimeout;function fr(t,e){e.useNativeTimers?(t.setTimeoutFn=dr.bind(lr),t.clearTimeoutFn=pr.bind(lr)):(t.setTimeoutFn=lr.setTimeout.bind(lr),t.clearTimeoutFn=lr.clearTimeout.bind(lr))}class gr extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}class yr extends ar{constructor(t){super(),this.writable=!1,fr(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,n){return super.emitReserved("error",new gr(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=cr(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const wr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mr=64,br={};let kr,_r=0,vr=0;function Sr(t){let e="";do{e=wr[t%mr]+e,t=Math.floor(t/mr)}while(t>0);return e}function Cr(){const t=Sr(+new Date);return t!==kr?(_r=0,kr=t):t+"."+Sr(_r++)}for(;vr<mr;vr++)br[wr[vr]]=vr;function Er(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}let Ar=!1;try{Ar="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const Dr=Ar;function Or(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Dr))return new XMLHttpRequest}catch(t){}if(!e)try{return new(lr[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function Nr(){}const Tr=null!=new Or({xdomain:!1}).responseType;class Ir extends ar{constructor(t,e){super(),fr(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=ur(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new Or(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=Ir.requestsCount++,Ir.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Nr,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Ir.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function Lr(){for(let t in Ir.requests)Ir.requests.hasOwnProperty(t)&&Ir.requests[t].abort()}Ir.requestsCount=0,Ir.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Lr):"function"==typeof addEventListener&&addEventListener("onpagehide"in lr?"pagehide":"unload",Lr,!1));const Rr="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),xr=lr.WebSocket||lr.MozWebSocket,Mr="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Br={websocket:class extends yr{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,n=Mr?{}:ur(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Mr?new xr(t,e,n):e?new xr(t,e):new xr(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],s=e===t.length-1;nr(n,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}s&&Rr((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Cr()),this.supportsBinary||(t.b64=1);const s=Er(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!xr}},polling:class extends yr{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=Tr&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const n=t.split(hr),s=[];for(let t=0;t<n.length;t++){const r=cr(n[t],e);if(s.push(r),"error"===r.type)break}return s})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const n=t.length,s=new Array(n);let r=0;t.forEach(((t,i)=>{nr(t,!1,(t=>{s[i]=t,++r===n&&e(s.join(hr))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Cr()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const s=Er(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Ir(this.uri(),t)}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Ur=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Pr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function jr(t){const e=t,n=t.indexOf("["),s=t.indexOf("]");-1!=n&&-1!=s&&(t=t.substring(0,n)+t.substring(n,s).replace(/:/g,";")+t.substring(s,t.length));let r=Ur.exec(t||""),i={},o=14;for(;o--;)i[Pr[o]]=r[o]||"";return-1!=n&&-1!=s&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||n.splice(0,1),"/"==e.slice(-1)&&n.splice(n.length-1,1),n}(0,i.path),i.queryKey=function(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,s){e&&(n[e]=s)})),n}(0,i.query),i}class qr extends ar{constructor(t,e={}){super(),this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=jr(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=jr(e.host).host),fr(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},n=t.split("&");for(let t=0,s=n.length;t<s;t++){let s=n[t].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Br[t](n)}open(){let t;if(this.opts.rememberUpgrade&&qr.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),n=!1;qr.priorWebsocketSuccess=!1;const s=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;qr.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(a(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function r(){n||(n=!0,a(),e.close(),e=null)}const i=t=>{const n=new Error("probe error: "+t);n.transport=e.name,r(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function c(){i("socket closed")}function h(t){e&&t.name!==e.name&&r()}const a=()=>{e.removeListener("open",s),e.removeListener("error",i),e.removeListener("close",o),this.off("close",c),this.off("upgrading",h)};e.once("open",s),e.once("error",i),e.once("close",o),this.once("close",c),this.once("upgrading",h),e.open()}onOpen(){if(this.readyState="open",qr.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+="string"==typeof(e=s)?function(t){let e=0,n=0;for(let s=0,r=t.length;s<r;s++)e=t.charCodeAt(s),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(s++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}var e;return this.writeBuffer}write(t,e,n){return this.sendPacket("message",t,e,n),this}send(t,e,n){return this.sendPacket("message",t,e,n),this}sendPacket(t,e,n,s){if("function"==typeof e&&(s=e,e=void 0),"function"==typeof n&&(s=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:t,data:e,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),s&&this.once("flush",s),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}onError(t){qr.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let n=0;const s=t.length;for(;n<s;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}qr.protocol=4,qr.protocol;const Fr="function"==typeof ArrayBuffer,Hr=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Vr=Object.prototype.toString,Wr="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Vr.call(Blob),zr="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Vr.call(File);function Jr(t){return Fr&&(t instanceof ArrayBuffer||Hr(t))||Wr&&t instanceof Blob||zr&&t instanceof File}function $r(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if($r(t[e]))return!0;return!1}if(Jr(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return $r(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&$r(t[e]))return!0;return!1}function Kr(t){const e=[],n=t.data,s=t;return s.data=Yr(n,e),s.attachments=e.length,{packet:s,buffers:e}}function Yr(t,e){if(!t)return t;if(Jr(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=Yr(t[s],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=Yr(t[s],e));return n}return t}function Gr(t,e){return t.data=Xr(t.data,e),delete t.attachments,t}function Xr(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Xr(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Xr(t[n],e));return t}const Qr=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Zr=5;var ti;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(ti||(ti={}));class ei{constructor(t){this.replacer=t}encode(t){return t.type!==ti.EVENT&&t.type!==ti.ACK||!$r(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===ti.EVENT?ti.BINARY_EVENT:ti.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==ti.BINARY_EVENT&&t.type!==ti.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Kr(t),n=this.encodeAsString(e.packet),s=e.buffers;return s.unshift(n),s}}function ni(t){return"[object Object]"===Object.prototype.toString.call(t)}class si extends ar{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===ti.BINARY_EVENT;n||e.type===ti.BINARY_ACK?(e.type=n?ti.EVENT:ti.ACK,this.reconstructor=new ri(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Jr(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===ti[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ti.BINARY_EVENT||n.type===ti.BINARY_ACK){const s=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const r=t.substring(s,e);if(r!=Number(r)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===t.charAt(e+1)){const s=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);n.nsp=t.substring(s,e)}else n.nsp="/";const s=t.charAt(e+1);if(""!==s&&Number(s)==s){const s=e+1;for(;++e;){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(s,e+1))}if(t.charAt(++e)){const s=this.tryParse(t.substr(e));if(!si.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case ti.CONNECT:return ni(e);case ti.DISCONNECT:return void 0===e;case ti.CONNECT_ERROR:return"string"==typeof e||ni(e);case ti.EVENT:case ti.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Qr.indexOf(e[0]));case ti.ACK:case ti.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ri{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Gr(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ii(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const oi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ci extends ar{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ii(t,"open",this.onopen.bind(this)),ii(t,"packet",this.onpacket.bind(this)),ii(t,"error",this.onerror.bind(this)),ii(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(oi.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const n={type:ti.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,s=e.pop();this._registerAckCallback(t,s),n.id=t}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(t,e){var n;const s=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===s)return void(this.acks[t]=e);const r=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),s);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(r),e.apply(this,[null,...t])}}emitWithAck(t,...e){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((s,r)=>{e.push(((t,e)=>n?t?r(t):s(e):s(t))),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...s)=>{if(n===this._queue[0])return null!==t?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...s)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ti.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ti.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ti.EVENT:case ti.BINARY_EVENT:this.onevent(t);break;case ti.ACK:case ti.BINARY_ACK:this.onack(t);break;case ti.DISCONNECT:this.ondisconnect();break;case ti.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...s){n||(n=!0,e.packet({type:ti.ACK,id:t,data:s}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ti.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function hi(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}hi.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},hi.prototype.reset=function(){this.attempts=0},hi.prototype.setMin=function(t){this.ms=t},hi.prototype.setMax=function(t){this.max=t},hi.prototype.setJitter=function(t){this.jitter=t};class ai extends ar{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,fr(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=n.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new hi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const r=n.parser||e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new qr(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=ii(e,"open",(function(){n.onopen(),t&&t()})),r=ii(e,"error",(e=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",e),t?t(e):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&s();const n=this.setTimeoutFn((()=>{s(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(s),this.subs.push(r),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ii(t,"ping",this.onping.bind(this)),ii(t,"data",this.ondata.bind(this)),ii(t,"error",this.onerror.bind(this)),ii(t,"close",this.onclose.bind(this)),ii(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){Rr((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new ci(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const li={};function ui(t,e){"object"==typeof t&&(e=t,t=void 0);const n=function(t,e="",n){let s=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),s=jr(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(n&&n.port===s.port?"":":"+s.port),s}(t,(e=e||{}).path||"/socket.io"),s=n.source,r=n.id,i=n.path,o=li[r]&&i in li[r].nsps;let c;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?c=new ai(s,e):(li[r]||(li[r]=new ai(s,e)),c=li[r]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(ui,{Manager:ai,Socket:ci,io:ui,connect:ui});var di=class extends l{constructor(t,e,n=new we,{autoConnect:s=!0,awareness:r=new Js(n),resyncInterval:i=-1,disableBc:o=!1,auth:c={}}){for(super(),this.bcconnected=!1,this._synced=!1,this.resyncInterval=null,this.initSyncListeners=()=>{this.socket.on("sync-step-1",((t,e)=>{e(Te(this.doc,new Uint8Array(t))),this.synced=!0})),this.socket.on("sync-update",this.onSocketSyncUpdate)},this.initAwarenessListeners=()=>{this.socket.on("awareness-update",(t=>{Ys(this.awareness,new Uint8Array(t),this)}))},this.initSystemListeners=()=>{"undefined"!=typeof window?window.addEventListener("beforeunload",this.beforeUnloadHandler):"undefined"!=typeof process&&process.on("exit",this.beforeUnloadHandler)},this.onSocketConnection=(t=-1)=>{this.emit("status",[{status:"connected"}]),this.socket.emit("sync-step-1",Re(this.doc),(t=>{Oe(this.doc,new Uint8Array(t),this)})),null!==this.awareness.getLocalState()&&this.socket.emit("awareness-update",Ks(this.awareness,[this.doc.clientID])),t>0&&(this.resyncInterval=setInterval((()=>{this.socket.disconnected||this.socket.emit("sync-step-1",Re(this.doc),(t=>{Oe(this.doc,new Uint8Array(t),this)}))}),t))},this.onSocketDisconnection=t=>{this.emit("connection-close",[t,this]),this.synced=!1,$s(this.awareness,Array.from(this.awareness.getStates().keys()).filter((t=>t!==this.doc.clientID)),this),this.emit("status",[{status:"disconnected"}])},this.onSocketConnectionError=t=>{this.emit("connection-error",[t,this])},this.onUpdateDoc=(t,e)=>{e!==this&&(this.socket.emit("sync-update",t),this.bcconnected&&zs(this._broadcastChannel,{type:"sync-update",data:t},this))},this.onSocketSyncUpdate=t=>{Oe(this.doc,new Uint8Array(t),this)},this.awarenessUpdate=({added:t,updated:e,removed:n},s)=>{let r=t.concat(e).concat(n);this.socket.emit("awareness-update",Ks(this.awareness,r)),this.bcconnected&&zs(this._broadcastChannel,{type:"awareness-update",data:Ks(this.awareness,r)},this)},this.beforeUnloadHandler=()=>{$s(this.awareness,[this.doc.clientID],"window unload")},this.connectBc=()=>{var t,e;this.bcconnected||(t=this._broadcastChannel,e=this.onBroadcastChannelMessage,Ws(t).subs.add(e),this.bcconnected=!0),zs(this._broadcastChannel,{type:"sync-step-1",data:Re(this.doc)},this),zs(this._broadcastChannel,{type:"sync-step-2",data:Te(this.doc)},this),zs(this._broadcastChannel,{type:"query-awareness",data:null},this),zs(this._broadcastChannel,{type:"awareness-update",data:Ks(this.awareness,[this.doc.clientID])},this)},this.disconnectBc=()=>{zs(this._broadcastChannel,{type:"awareness-update",data:Ks(this.awareness,[this.doc.clientID],new Map)},this),this.bcconnected&&(((t,e)=>{const n=Ws(t);n.subs.delete(e)&&0===n.subs.size&&(n.bc.close(),Hs.delete(t))})(this._broadcastChannel,this.onBroadcastChannelMessage),this.bcconnected=!1)},this.onBroadcastChannelMessage=(t,e)=>{if(e!==this&&t.type.length>0)switch(t.type){case"sync-step-1":zs(this._broadcastChannel,{type:"sync-step-2",data:Te(this.doc,t.data)},this);break;case"sync-step-2":case"sync-update":Oe(this.doc,new Uint8Array(t.data),this);break;case"query-awareness":zs(this._broadcastChannel,{type:"awareness-update",data:Ks(this.awareness,Array.from(this.awareness.getStates().keys()))},this);break;case"awareness-update":Ys(this.awareness,new Uint8Array(t.data),this)}};"/"===t[t.length-1];)t=t.slice(0,t.length-1);this._url=t,this.roomName=e,this.doc=n,this.awareness=r,this._broadcastChannel=`${t}/${e}`,this.disableBc=o,this.socket=ui(`${this.url}/yjs|${e}`,{autoConnect:!1,transports:["websocket"],forceNew:!0,auth:c}),this.doc.on("update",this.onUpdateDoc),this.socket.on("connect",(()=>this.onSocketConnection(i))),this.socket.on("disconnect",(t=>this.onSocketDisconnection(t))),this.socket.on("connect_error",(t=>this.onSocketConnectionError(t))),this.initSyncListeners(),this.initAwarenessListeners(),this.initSystemListeners(),r.on("update",this.awarenessUpdate),s&&this.connect()}get broadcastChannel(){return this._broadcastChannel}get url(){return this._url}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}connect(){this.socket.connected||(this.emit("status",[{status:"connecting"}]),this.socket.connect(),this.disableBc||this.connectBc(),this.synced=!1)}disconnect(){this.socket.connected&&(this.disconnectBc(),this.socket.disconnect())}destroy(){null!=this.resyncInterval&&clearInterval(this.resyncInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this.beforeUnloadHandler):"undefined"!=typeof process&&process.off("exit",this.beforeUnloadHandler),this.awareness.off("update",this.awarenessUpdate),this.doc.off("update",this.onUpdateDoc),super.destroy()}},pi=function(t,e){var n=Object.freeze({ONGOING:1,FINISHED_WRONG:2,FINISHED_CORRECT:3,INTERNAL_SOLUTION:4,EXTERNAL_SOLUTION:5}),s=Object.freeze({CHECK:"check-answer",TRYAGAIN:"try-again",SHOW_SOLUTION:"show-solution"});function r(i,o,c){var h=this;console.log("we comming back");var a=this;e.call(a,"true-false");var l=t.extend(!0,{question:"No question text provided",correct:"true",l10n:{trueText:"True",falseText:"False",score:"You got @score of @total points",checkAnswer:"Check",submitAnswer:"Submit",showSolutionButton:"Show solution",tryAgain:"Retry",wrongAnswerMessage:"Wrong answer",correctAnswerMessage:"Correct answer",scoreBarLabel:"You got :num out of :total points",a11yCheck:"Check the answers. The responses will be marked as correct, incorrect, or unanswered.",a11yShowSolution:"Show the solution. The task will be marked with its correct solution.",a11yRetry:"Retry the task. Reset all responses and start the task over again."},behaviour:{enableRetry:!0,enableSolutionsButton:!0,enableCheckButton:!0,confirmCheckDialog:!1,confirmRetryDialog:!1,autoCheck:!1}},i);r.counter=void 0===r.counter?0:r.counter+1;var u="h5p-tfq"+H5P.TrueFalse.counter;this.contentId=o,this.contentData=c,this.doc=new we,this.provider=new di("ws://192.168.1.3:1234",o+u,this.doc,{});var d=new H5P.TrueFalse.AnswerGroup(o+u,l.correct,l.l10n),p=this.doc.getMap("action");p.get("action")||p.set("action","initial"),p.observe((function(t){t.target,t.keysChanged,t.changes.keys,t.changes.keys.forEach((function(t,e){"add"===t.action?"currentPage"===e&&h.processJumpToSlide(p.get("currentPage")):"update"===t.action?("action"===e&&"checkAnswer"===p.get(e)&&v(),"reset"===e&&h.IresetTask()):t.action}))})),d.on("selected",(function(){console.log("hai qua hihi"),a.triggerXAPI("interacted"),l.behaviour.autoCheck&&(S(),g())}));var f=function(){var e,r=t('[data-content-id="'+a.contentId+'"].h5p-content'),i=r.parents(".h5p-container");e=0!==i.length?i.last():0!==r.length?r:t(document.body),!0===l.behaviour.enableSolutionsButton&&a.addButton(s.SHOW_SOLUTION,l.l10n.showSolutionButton,(function(){a.showSolutions(!0)}),!1,{"aria-label":l.l10n.a11yShowSolution}),!l.behaviour.autoCheck&&l.behaviour.enableCheckButton&&a.addButton(s.CHECK,l.l10n.checkAnswer,(function(){S(),g()}),!0,{"aria-label":l.l10n.a11yCheck},{confirmationDialog:{enable:l.behaviour.confirmCheckDialog,l10n:l.confirmCheck,instance:a,$parentElement:e},contentData:a.contentData,textIfSubmitting:l.l10n.submitAnswer}),!0===l.behaviour.enableRetry&&a.addButton(s.TRYAGAIN,l.l10n.tryAgain,(function(){a.resetTask()}),!0,{"aria-label":l.l10n.a11yRetry},{confirmationDialog:{enable:l.behaviour.confirmRetryDialog,l10n:l.confirmRetry,instance:a,$parentElement:e}}),_(n.ONGOING)},g=function(){var t=a.createXAPIEventTemplate("answered");y(t),b(t),a.trigger(t)},y=function(e){var n=e.getVerifiedStatementValue(["object","definition"]);n.description={"en-US":t("<div>"+l.question+"</div>").text()},n.type="http://adlnet.gov/expapi/activities/cmi.interaction",n.interactionType="true-false",n.correctResponsesPattern=[w()]},w=function(){return"true"===l.correct?"true":"false"},m=function(){return"false"===l.correct?"true":"false"},b=function(t){var e=d.isCorrect();t.setScoredResult(e?1:0,1,a,!0,e),t.data.statement.result.response=e?w():m()},k=function(t,e){!0===e?a.showButton(t):a.hideButton(t)},_=function(t){k(s.SHOW_SOLUTION,t===n.FINISHED_WRONG),k(s.CHECK,t===n.ONGOING),k(s.TRYAGAIN,t===n.FINISHED_WRONG||t===n.INTERNAL_SOLUTION)},v=function(){var t,e=a.getScore();_(1===e?n.FINISHED_CORRECT:n.FINISHED_WRONG),t=(t=1===e&&l.behaviour.feedbackOnCorrect?l.behaviour.feedbackOnCorrect:0===e&&l.behaviour.feedbackOnWrong?l.behaviour.feedbackOnWrong:l.l10n.score).replace("@score",e).replace("@total",1),a.setFeedback(t,e,1,l.l10n.scoreBarLabel),d.reveal()},S=function(){console.log("we checking"),console.log("afafafa"),p.set("action","checkAnswer"),v()};a.registerDomElements=function(){var t=this,e=l.media;if(e&&e.type&&e.type.library){var n=(e=e.type).library.split(" ")[0];"H5P.Image"===n?e.params.file&&t.setImage(e.params.file.path,{disableImageZooming:l.media.disableImageZooming||!1,alt:e.params.alt}):"H5P.Video"===n?e.params.sources&&t.setVideo(e):"H5P.Audio"===n&&e.params.files&&t.setAudio(e)}t.setIntroduction('<div id="'+u+'">'+l.question+"</div>"),t.$content=d.getDomElement(),t.setContent(t.$content),f()},a.getCurrentState=function(){return{answer:d.getAnswer()}},a.getAnswerGiven=function(){return d.hasAnswered()},a.getScore=function(){return d.isCorrect()?1:0},a.getMaxScore=function(){return 1},a.getTitle=function(){return H5P.createTitle(a.contentData&&a.contentData.metadata&&a.contentData.metadata.title?a.contentData.metadata.title:"True-False")},a.showSolutions=function(t){S(),d.showSolution(),_(t?n.INTERNAL_SOLUTION:n.EXTERNAL_SOLUTION)},a.resetTask=function(){d.reset(),a.removeFeedback(),_(n.ONGOING)},a.getXAPIData=function(){var t=this.createXAPIEventTemplate("answered");return this.addQuestionToXAPI(t),this.addResponseToXAPI(t),{statement:t.data.statement}},a.addQuestionToXAPI=function(e){var n=e.getVerifiedStatementValue(["object","definition"]);t.extend(n,this.getxAPIDefinition())},a.getxAPIDefinition=function(){var e={interactionType:"true-false",type:"http://adlnet.gov/expapi/activities/cmi.interaction"};return e.description={"en-US":t("<div>"+l.question+"</div>").text()},e.correctResponsesPattern=[w()],e},a.addResponseToXAPI=function(t){var e=d.isCorrect(),n=e?1:0,s="";t.setScoredResult(n,1,a,!0,e),void 0!==a.getCurrentState().answer&&(s+=d.isCorrect()?w():m()),t.data.statement.result.response=s}}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r}(H5P.jQuery,H5P.Question),fi=function(t,e){function n(n,s,r){var i=this;console.log("we are in answer group"),e.call(i);var o,c=t("<div>",{class:"h5p-true-false-answers",role:"radiogroup","aria-labelledby":n}),h=new we,a=(new di("ws://192.168.1.3:1234",n,h,{}),h.getMap("answer"));a.observe((function(t){if(console.log("answer group obss"),t.keysChanged.has("answer")){var e=a.get("answer");if(e==o)return;e?l.check():u.check()}}));var l=new H5P.TrueFalse.Answer(r.trueText,r.correctAnswerMessage,r.wrongAnswerMessage),u=new H5P.TrueFalse.Answer(r.falseText,r.correctAnswerMessage,r.wrongAnswerMessage),d="true"===s?l:u,p="false"===s?l:u,f=function(t,e){return function(){a.set("answer",t),o=t,e.uncheck(),i.trigger("selected")}};l.on("checked",f(!0,u)),u.on("checked",f(!1,l));var g=function(t,e){return function(){a.set("answer",t),o=t,e.check(),i.trigger("selected")}};l.on("invert",g(!1,u)),u.on("invert",g(!0,l));var y=function(t,e){return function(){e&&i.hasAnswered()&&!t.isChecked()||t.tabable(e)}};l.on("focus",y(u,!1)),u.on("focus",y(l,!1)),l.on("blur",y(u,!0)),u.on("blur",y(l,!0)),c.append(l.getDomElement()),c.append(u.getDomElement()),i.getDomElement=function(){return c},i.check=function(t){t?l.check():u.check()},i.getAnswer=function(){return o},i.hasAnswered=function(){return void 0!==o},i.isCorrect=function(){return d.isChecked()},i.enable=function(){l.enable().tabable(!0),u.enable()},i.disable=function(){l.disable(),u.disable()},i.reveal=function(){i.hasAnswered()&&(i.isCorrect()?d.markCorrect():p.markWrong()),i.disable()},i.reset=function(){l.reset(),u.reset(),i.enable(),o=void 0},i.showSolution=function(){d.markCorrect(),p.unmark()}}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n}(H5P.jQuery,H5P.EventDispatcher);H5P=H5P||{},H5P.Tooltip=H5P.Tooltip||function(){},H5P.TrueFalse=pi,H5P.TrueFalse.AnswerGroup=fi})();